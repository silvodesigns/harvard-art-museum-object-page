var transEndEventNames={WebkitTransition:"webkitTransitionEnd",OTransition:"oTransitionEnd",msTransition:"msTransitionEnd",transition:"transitionend"},animEndEventNames={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"},transEndEventName=transEndEventNames[Modernizr.prefixed("transition")],animEndEventName=animEndEventNames[Modernizr.prefixed("animation")];$(document).ready(function(){ham.LoadBehavior(),$.ajax({url:"/user/getcurrent",async:!1}).done(function(e){ham.user=e}),ham.helper.is_mobile()||ham.helper.is_tablet()||!Modernizr.history||ham.helper.open_artwork()}),ham.viewer={},ham.viewer.current={},ham.viewer.helper={},ham.behavior.add_to_collection=function(e){"use strict";var t=e.closest("#artwork").length?e.closest("#artwork"):$("body"),o={settings:{artworkid:-1,create_markup:"",select_markup:""},main_class:e.data("main-class")||"",collections:[],init:function(){$.ajax({url:"/user/getcurrent",async:!1}).done(function(e){ham.user=e}),"list"==e.data("view")?e.on("click","[data-artwork]",function(e){ham.user?(o.settings.artworkid=$(this).data("artwork"),o.get_collection_list(o.settings.artworkid),o.collections.length<=0?o.create_collection():o.select_collection()):o.open_lightbox("#popup-login"),e.preventDefault()}):(o.settings.artworkid=e.data("artwork"),e.on("click",function(e){ham.user?(o.get_collection_list(o.settings.artworkid),o.collections.length<=0?o.create_collection():o.select_collection()):o.open_lightbox("#popup-login"),e.preventDefault()})),$.validator.setDefaults({errorClass:"control__error",errorElement:"span",validClass:"control__valid"}),t.on("click.lightbox","[data-popup-close]",function(e){o.close_lightbox(),e.preventDefault()}),t.on("click.lightbox","[data-collection-switch]",function(e){"create"===$(this).data("collection-switch")?o.create_collection():o.select_collection(),e.preventDefault()})},generate_create_popup:function(){var e=o.get_artwork_info(o.settings.artworkid),t="";e.people&&$.each(e.people,function(e,o){t+=0==e?o.displayname:", "+o.displayname}),o.settings.create_markup='<section id="create-collection" class="popup"><header class="popup__header"><span class="popup__title">Create Collection</span><span class="popup__subtitle">Add this item to your collection</span></header><div class="popup__artwork-info"><img src="'+(e.primaryimageurl?e.primaryimageurl+"?width=200&height=200":"/assets/images/no_image_thumb.png")+'"><span class="popup__artwork-info-id">'+e.objectnumber+"</span>"+(""!=t?'<span class="popup__artwork-info-author">'+t+"</span>":"")+'<span class="popup__artwork-info-title">'+e.title+'</span><span class="popup__artwork-info-class">'+e.classification+'</span></div><form action="/mycollection/add" method="POST"><div class="form-row"><div class="control control--full"><label for="collection-name" class="control__label">Collection Name</label><input type="text" name="collection-name" id="collection-name" required class="control__input"></div></div><div class="form-row form-row--submit"><div class="control control--full"><input type="submit" value="Create Collection" class="btn-block control__button--invert"></div></div></form><footer class="popup__footer"><a href="#" data-popup-close>Cancel</a>'+(o.collections.length>0?' or <a href="#" data-collection-switch="select">Add to existing collection</a>':"")+"</footer></section>"},generate_select_popup:function(){var e=o.get_artwork_info(o.settings.artworkid),t="";e.people&&$.each(e.people,function(e,o){t+=0==e?o.displayname:", "+o.displayname}),o.settings.select_markup='<section id="select-collection" class="popup"><header class="popup__header"><span class="popup__title">Your Collection</span><span class="popup__subtitle">Add this item to your collection</span></header><div class="popup__artwork-info"><img src="'+(e.primaryimageurl?e.primaryimageurl+"?width=200&height=200":"/assets/images/no_image_thumb.png")+'"><span class="popup__artwork-info-id">'+e.objectnumber+"</span>"+(""!=t?'<span class="popup__artwork-info-author">'+t+"</span>":"")+'<span class="popup__artwork-info-title">'+e.title+'</span><span class="popup__artwork-info-class">'+e.classification+'</span></div><form action="/mycollection/add" method="POST"><div class="form-row"><div class="control control--full"><label for="collection-list" class="control__label">Collection Name</label><select id="collection-list" name="collection-list">'+o.generate_select_markup()+'</select></div></div><div class="form-row form-row--submit"><div class="control control--full"><input type="submit" value="Add to Collection" class="btn-block control__button--invert"></div></div></form><footer class="popup__footer"><a href="#" data-popup-close>Cancel</a> or <a href="#" data-collection-switch="create">Create a new collection</a></footer></section>'},generate_select_markup:function(){var e="";return $.each(o.collections,function(t,o){e+='<option value="'+o.id+'">'+o.title+"</option>"}),e},get_collection_list:function(e){var t={artwork_id:e||""};$.ajax({url:"/mycollections/list",data:t,async:!1}).done(function(e){o.collections=e})},select_collection:function(){o.generate_select_popup(),o.open_lightbox(o.settings.select_markup),$("#select-collection form").validate({submitHandler:function(e){var t=$(e).serialize().split("=");o.save_collection("mycollectionid",t[1])}})},create_collection:function(){o.generate_create_popup(),o.open_lightbox(o.settings.create_markup),$("#create-collection form").validate({submitHandler:function(e){var t=$("#collection-name",e).val();o.save_collection("mycollectiontitle",t)}})},save_collection:function(e,t){var a={artworkid:o.settings.artworkid};a[e]=t,ham.helper.ajax("/mycollection/add",a,"POST",function(e,t){e&&o.get_collection_list(o.settings.artworkid),o.notify(t)})},open_lightbox:function(e){$.magnificPopup.open({closeOnBgClick:!1,midClick:!0,mainClass:"mfp-trans-bg "+o.main_class,items:{type:"inline",src:e},overflowY:"scroll",closeMarkup:'<button class="mfp-close">Back <i class="mfp-close-icn"></i></button>',removalDelay:200,prependTo:t,callbacks:{open:function(){ham.LoadBehavior(this.content)},change:function(){ham.LoadBehavior(this.content)},close:function(){}}})},close_lightbox:function(){$.magnificPopup.close(),$.magnificPopup.instance.popupsCache={}},notify:function(e){1==e?($(".popup .form-row--submit .control").html('<span class="btn btn-block btn-success">Added!</span>'),setTimeout(function(){o.close_lightbox()},500)):console.log("Error! Something went wrong")},get_artwork_info:function(e){var t;return $.ajax({url:"/artwork/getInfo/"+e,async:!1}).done(function(e){t=e}),t}};o.init()},ham.behavior.art_study_center=function(e){"use strict";var t=($("#select-by-id",e),$("#select-by-collection",e),{artworks:[],visitors:[],form_data:{},init:function(){t.parse_date(),t.add_visitor(),e.submit(function(o){$("#select-object",e).is(":focus")?$("#search-artwork",e).click():t.validate_form(),o.preventDefault()}),$(":input[required]",e).on("change",function(){t.validate_field($(this))}),$("#selected-artwork",e).on("artwork_added",function(e){t.artworks.push(e.item.objectnumber)}),$("#selected-artwork",e).on("artwork_removed",function(e){t.artworks=$.grep(t.artworks,function(t){return t!=e.artwork.objectnumber})})},validate_form:function(){var o=0;$(":input[required]",e).each(function(e,a){t.validate_field($(this))&&o++}),t.artworks.length<=0?($("#select-by-collection, #select-by-id",e).addClass("control--error"),o++):$("#select-by-collection, #select-by-id",e).removeClass("control--error"),t.visitors.length<=0?($("#visitor-f-name, #visitor-l-name",e).addClass("control--error"),o++):$("#visitor-f-name, #visitor-l-name",e).removeClass("control--error"),0==o?(t.manipulate_data(),$(":submit",e).addClass("btn--loading"),ham.helper.ajax("/teaching-and-research/art-study-center",t.form_data,"POST",function(o,a){if($(":submit",e).removeClass("btn--loading"),$(".control--error",e).removeClass("control--error"),$(".msg-error",e).remove(),o)$(":submit",e).addClass("btn-success").val("Sent!").prop("disabled",!0).after('<span class="control__note">Thank you for your request. Someone will contact you soon.</span>');else{var i=a.responseJSON.messages;$.each(i,function(t,o){"date"==t?($("#"+t,e).find(".form-row:first").prepend('<span class="msg-error">'+o+"</span>"),$("#"+t,e).find(".control").addClass("control--error")):$("#"+t,e).prepend('<span class="msg-error">'+o+"</span>").find(".control").addClass("control--error")}),t.scroll_to_error()}})):t.scroll_to_error()},scroll_to_error:function(){$("html, body").animate({scrollTop:$(".control--error").first().offset().top-80},300)},validate_field:function(e){return e.is("[data-date-year], [data-date-month], [data-date-day]")?t.validate_date(e)||""==e.val()?(e.closest(".control").addClass("control--error"),!0):(e.closest(".control").removeClass("control--error"),!1):"email"==e.attr("type")?t.validate_email(e.val())&&""!=e.val()?(e.closest(".control").removeClass("control--error"),!1):(e.closest(".control").addClass("control--error"),!0):""==e.val()?(e.closest(".control").addClass("control--error"),!0):(e.closest(".control").removeClass("control--error"),!1)},validate_email:function(e){return/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)},validate_date:function(t){var o=t.data("date-select");if(""!=$("#date"+o+"-year",e).val()&&""!=$("#date"+o+"-month",e).val()&&""!=$("#date"+o+"-day",e).val()){var a=$("#date"+o,e).val();return $("#date"+o,e).closest(".form-row").find(".msg-error").remove(),moment(a).isBefore()?($("#date"+o,e).closest(".form-row").find("label").after('<span class="msg-error">The date must be in the future</span>').find(".control").slice(0,2).addClass("control--error"),!0):($("#date"+o,e).closest(".form-row").find(".control").removeClass("control--error"),!1)}},manipulate_data:function(){t.form_data.date=$('[name="date1"]',e).val(),t.form_data.date_time=$('[name="date1-time"]',e).val(),t.form_data.date2=$('[name="date2"]',e).val(),t.form_data.date2_time=$('[name="date2-time"]',e).val(),t.form_data.date3=$('[name="date3"]',e).val(),t.form_data.date3_time=$('[name="date3-time"]',e).val(),t.form_data.purpose_visit=$('[name="visit-purpose"]:checked',e).val(),t.form_data.requirements=$('[name="requirements"]:checked').map(function(){return this.value}).get(),t.form_data.artworks=t.artworks,$("#contact-info :input",e).each(function(e,o){t.form_data[this.name]=this.value}),t.form_data.visitors=t.visitors,t.form_data.notes=$('[name="notes"]',e).val()},parse_date:function(){$("[data-date-select]",e).on("change",function(o){var a=$(this),i="",r=a.data("date-select");(a.is("[data-date-month]")||a.is("[data-date-year]"))&&t.update_days(r),i=$("#date"+r+"-year",e).val()+"-"+$("#date"+r+"-month",e).val()+"-"+$("#date"+r+"-day",e).val(),$("#date"+r,e).val(i),t.validate_date(a)})},update_days:function(t){var o=$("#date"+t+"-month",e).val(),a=$("#date"+t+"-day",e),i=$("#date"+t+"-year",e),r=a.val(),n=i.val(),s=31;a.empty(),2==o?s=28:4!=o&&6!=o&&9!=o&&11!=o||(s=30);for(var l=1;l<=s;l++)a.append('<option value="'+l+'"'+(r==l?" selected":"")+">"+l+"</option>");parseInt(n)%4==0&&a.append('<option value="29"'+(29==r?" selected":"")+">29</option>"),a.prepend('<option value="-1">Day</option>')},add_visitor:function(){$("#add-visitor",e).on("click",function(o){var a={first_name:$("#visitor_first_name",e).val(),last_name:$("#visitor_last_name",e).val(),role_id:parseInt($('[name="visitor_role"]:checked',e).val()),role_note:$("#visitor_role_note",e).val()};a.role_pretty=t.visitor_role(a.role_id),t.store_visitor(a),o.preventDefault()}),$(".visitor-list",e).on("click",".visitor-list__remove",function(e){var o=$(this).closest("li"),a=o.index();t.visitors.splice(a,1),o.remove(),e.preventDefault()})},store_visitor:function(o){t.validate_field($("#visitor_first_name",e))||t.validate_field($("#visitor_last_name",e))||(t.visitor_set_template(o),t.visitors.push(o),$("#visitor_first_name, #visitor_last_name, #visitor_role_note",e).val(""))},visitor_set_template:function(t){var o=ham.templates.visitor_info,a=$.parseHTML(Mustache.render(o,t));$(".visitor-list",e).append(a)},visitor_role:function(e){switch(e){case 1:return"Harvard Affiliate";case 2:return"Faculty";case 3:return"Student";case 4:return"Museum Staff";case 5:return"Other";case 6:return"Department"}}});t.init()},ham.behavior.article_links=function(){"use strict";var e=$(".detail-page--content a");$.each(e,function(e,t){var o=$(t).attr("href");-1==o.indexOf("/article/")&&-1==o.indexOf("/collections/object/")&&-1==o.indexOf("#")&&$(t).attr("target","_blank")})},ham.behavior.article_overlay=function(e){"use strict";function t(){var t=e.innerWidth();i.width(t),a.position().left>=t&&(a.css({left:t-1}),r.width(t-1)),o()}function o(){i.each(function(){var e=$(this);e.height()>n&&(n=e.height())}),e.height(n)}var e=$(this),a=$('<div class="tour-overlay__handle"><span /></div>'),i=$(".tour-overlay__image-wrapper img",e),r=$(".tour-overlay__image-wrapper",e).first(),n=($('<div class="tour-overlay__image-data">'),0);t(),$(".tour-overlay__handle").length||$(".tour-overlay__component").append(a),a.draggable({axis:"x",containment:e,drag:function(e,t){r.width(t.position.left)}}),$(window).resize($.debounce(200,function(){n=0,t()}))},ham.behavior.article_tools=function(e){"use strict";var t=e.data("article-id"),o=e.closest(".tour-grid-item");$('[data-tool="publish"]',e).on("click",function(o){var a=$(this),i=a.siblings(".tooltip"),r={id:t,published:1==e.data("article-published")?0:1};ham.helper.ajax("/article/publish",r,"POST",function(t,o){t&&(e.data("article-published",r.published),1==r.published?(a.text("Unpublish"),i.text("Unpublish")):(a.text("Publish"),i.text("Publish")),a.toggleClass("tools__publish tools__unpublish"))}),o.preventDefault()}),$('[data-tool="delete"]',e).on("click",function(e){$(this);window.confirm("Are you sure you want to delete this article?")&&ham.helper.ajax("/article/"+t+"/destroy",null,"GET",function(e,t){e&&o.remove()}),e.preventDefault()})},ham.behavior.audio_player=function(e){"use strict";soundManager.setup({url:"/assets/swf",debugMode:!1,onready:function(){var t=soundManager.createSound({url:e.prop("href")});e.on({click:function(o){0===t.playState||t.paused?(t.play({onfinish:function(){e.removeClass("audio-player--playing")}}),e.addClass("audio-player--playing").removeClass("audio-player--paused").prop("title","Pause")):(t.pause(),e.removeClass("audio-player--playing").addClass("audio-player--paused").prop("title","Play")),o.preventDefault()},remove:function(){0===t.playState&&t.paused||(t.pause(),e.removeClass("audio-player--playing").addClass("audio-player--paused").prop("title","Play"))}})}})},ham.behavior.captions=function(e){"use strict";console.log("inside captions");var t,o=$("[data-gallery-item]",e),a=($("[data-zoom]",e),$(".hero-artwork__image-wrapper",e),$("figure",e)),i=$("figcaption",a);$('<span class="hero-artwork__cursor"></span>'),e.closest(".artwork__wrapper").length>0?e.closest(".artwork__wrapper"):$("html, body"),$(".toolbox",e);$("a",o).on("click",function(e){var o=$(this),a=o.data("object-caption"),r=o.data("object-copyright");t=o.closest("li").index(),i.empty(),a&&i.append('<span class="artwork__meta">'+a+"</span>"),r&&i.append('<span class="artwork__meta">&copy; '+r+"</span>"),a||r?i.removeClass("hidden"):i.addClass("hidden")})},ham.behavior.carousel_thumbs=function(){"use strict";function e(e,a){o=ham.helper.is_mobile()?85:165;var i=t.innerWidth(),r=Math.floor(i/o),n=a.count;e.width(o*Math.min(r,n)),$(".slideshow__direction-nav",t).toggleClass("hidden",r>=n),t.toggleClass("no-transform",r>=n),a.vars.itemWidth=o,a.itemW=o,$(a.slides).width(o),a.update()}var t=$(this),o=ham.helper.is_mobile()?85:165;t.imagesLoaded(function(){t.flexslider({namespace:"slideshow__",animation:"slide",slideshow:!1,controlNav:!1,animationLoop:!1,itemWidth:o,itemMargin:0,start:function(o){var a=$(".slideshow__viewport",t);e(a,o),$(window).on("resize",$.debounce(200,function(){e(a,o)}))}})})},ham.behavior.cat_nav_mobile_toggle=function(e){"use strict";function t(){s||!ham.helper.is_tablet()&&!ham.helper.is_mobile()?s&&(ham.helper.is_desktop()||ham.helper.is_widescreen())&&(r(),s=!1):(o(),s=!0)}function o(){e.on("click.cat_nav_mobile_toggle",function(e){e.preventDefault(),$("html").hasClass("mobile-cat-nav-active")?i():a()})}function a(){$("html").addClass("mobile-cat-nav-active"),$("#cat-nav-mobile .nav-primary > ul > li > a").on("click.cat_nav_mobile_toggle",function(e){var t=$(this);t.next().is(".sub-nav")&&($("h2",t.parent()).append('<a href="#">Back</a>'),t.parent().addClass("active"),$("#cat-nav-mobile").addClass("sub-nav-active"),e.preventDefault())}),$("#cat-nav-mobile .sub-nav__links h2").on("click.cat_nav_mobile_toggle","a",function(e){e.preventDefault();var t=$(this);$("#cat-nav-mobile").removeClass("sub-nav-active"),t.parents("li.active").removeClass("active").end().remove()})}function i(){$("html").removeClass("mobile-cat-nav-active"),$("#cat-nav-mobile").removeClass("sub-nav-active"),$("#cat-nav-mobile .nav-primary > ul > li").removeClass("active").find("h2 a").remove(),$("#cat-nav-mobile .nav-primary > ul > li > a").off("click.cat_nav_mobile_toggle"),$("#cat-nav-mobile .sub-nav__links h2").off("click.cat_nav_mobile_toggle","a")}function r(){i(),e.off("click.cat_nav_mobile_toggle")}var n,s=!1;t(),$(window).on("resize",function(){clearTimeout(n),n=setTimeout(t,250)})},ham.behavior.clock=function(e){"use strict";function t(e){return e/60*360}function o(e,t){var t=void 0!==t?t:n/2;return e/12*360+t}function a(e,t){e.css({transform:"rotate("+t+"deg)"})}function i(){r=new Date,n=r.getMinutes(),s=r.getHours(),l=t(n),c=o(s),a(p,o(s)),a(d,t(n))}var r,n,s,l,c,d=$(".min",e),p=$(".hr",e);!function(){i(),setInterval(function(){i()},6e4)}(),e.siblings("p").find("span").on({mouseenter:function(){var e=parseInt($(this).text());a(d,0),a(p,o(e,0))},mouseleave:i})},ham.behavior.close_article=function(e){"use strict";var t=document.referrer,o=t.replace(/\/+$/,""),a=o.replace(/^(https?:\/\/)?(www\.)?/,"");$("body").on("click",".im-article__close",function(e){switch(a){case"ham.dev":case"ham.dev:5000":case"ham.stage.a17.io":case"harvardartmuseums.org":e.preventDefault(),window.location.href=t}})},ham.behavior.collection_social=function(e){"use strict";e.on("click",function(t){var o={mycollectionid:$(this).data("collection")},a=$(this).data("share");ham.helper.ajax("/mycollection/public",o,"POST",function(t,o){if(t)switch(a){case"email":window.location.href=e.prop("href");break;case"facebook":window.location.href="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(o);break;case"twitter":window.location.href="https://twitter.com/home?status="+encodeURIComponent("See my collection from @harvartmuseums "+o)}}),t.preventDefault()})},ham.behavior.datepicker_inline=function(e){"use strict";function t(e){var t=e.getMonth(),o=e.getDate(),i=e.getFullYear(),r=new Date,n="";e<r&&(n="ui-datepicker-past-date");for(var s=0;s<a.length;s++)if(-1==$.inArray(i+"-"+(t+1)+"-"+o,a))return[!1,n,null];return[!0,n,null]}function o(e){var t={type:ham.events.type,date:e};ham.helper.ajax($("#events_list").data("url"),t,"GET",function(t,o){t&&($("#events_list").html(o),ham.events.date=e,$(window).resize())})}var a=$.map(e.data("enabled-dates"),function(e,t){return e}),i=e.next(".datepicker-input");e.datepicker({dayNamesMinType:["S","M","T","W","T","F","S"],beforeShowDay:t,onSelect:function(e){var t=e.split("/");o(t[2]+"-"+t[0]+"-"+t[1]),i.val(t[2]+"-"+t[1])},onChangeMonthYear:function(e,t,o){t=t<10?"0"+t:t,i.val(e+"-"+t).change()}}),e.on("click",".ui-datepicker-title",function(t){ham.helper.is_mobile()||ham.helper.is_tablet()?e.next(".datepicker-input").focus():i.trigger("change")}),i.on("change",function(){var t=$(this).val(),a=t.split("-");e.datepicker("setDate",a[1]+"/01/"+a[0]),o(t)})},ham.behavior.delete_collection=function(e){"use strict";var t=e.data("collection"),o=e.data("url");if(!t)return console.log("No Collection ID Specified"),!1;var a={settings:{},init:function(){e.on("click",function(e){a.generate_popup(),e.preventDefault()})},do_delete:function(){var a={mycollectionid:t};ham.helper.ajax("/mycollection/delete",a,"POST",function(t,a){if(t)if(!0===e.data("detail"))window.location=o;else{var i=e.parents(".collection-item");$.magnificPopup.instance.content.find(".popup__btn-wrap").html('<span class="btn btn-block btn-removed">Removed!</span>'),setTimeout(function(){$.magnificPopup.close(),i.remove()},500)}else console.log("error",a)})},generate_popup:function(){var t=e.closest(".collection-item__header").find("[data-title]").text();a.settings.popup_markup='<section id="delete-collection" class="popup"><div class="mfp-close"></div><header class="popup__header"><span class="popup__title">'+t+'</span><span class="popup__subtitle">Are you sure you want to remove this collection?</span></header><div class="popup__btn-wrap"><a href="#" class="btn-invert btn-collection-delete">Remove Collection</a></div><footer class="popup__footer"><a href="#" data-popup-close>Cancel</a></footer></section>',a.open_lightbox(a.settings.popup_markup)},open_lightbox:function(e){$.magnificPopup.open({closeOnBgClick:!1,midClick:!0,mainClass:"mfp-trans-bg",items:{type:"inline",src:e},overflowY:"scroll",removalDelay:200,callbacks:{open:function(){$(this.content).find(".btn-collection-delete").on("click",function(){a.do_delete()}),$(this.content).find("[data-popup-close]").on("click",function(e){$.magnificPopup.close(),e.preventDefault()})}}})}};a.init()},ham.behavior.delete_from_collection=function(e){"use strict";var t=e.data("collection"),o=e.data("artwork");if(!t||!o)return console.log("No ID Specified"),!1;var a={settings:{},init:function(){e.on("click",function(e){a.generate_popup(),e.preventDefault()})},get_artwork_info:function(e){var t;return $.ajax({url:"/artwork/getInfo/"+e,async:!1}).done(function(e){t=e}),t},remove_artwork:function(){var a={artworkid:o,mycollectionid:t};ham.helper.ajax("/mycollection/remove",a,"POST",function(t,o){if(t){var a=e.parents(".artwork-grid__item"),i=a.parents(".artwork-grid");$("#delete-collection .popup__btn-wrap").html('<span class="btn btn-block btn-removed">Removed!</span>'),setTimeout(function(){$.magnificPopup.close(),i.masonry("remove",a),i.masonry()},500)}else console.log("error",o)})},generate_popup:function(){var e=a.get_artwork_info(o),t="";e.people&&$.each(e.people,function(e,o){t+=0==e?o.displayname:", "+o.displayname}),a.settings.popup_markup='<section id="delete-collection" class="popup"><div class="mfp-close"></div><header class="popup__header"><span class="popup__title">'+e.title+'</span><span class="popup__subtitle">Are you sure you want to remove this item?</span></header><div class="popup__artwork-info"><img src="'+(e.primaryimageurl?e.primaryimageurl+"?width=200&height=200":"/assets/images/no_image_thumb.png")+'"><span class="popup__artwork-info-id">'+e.objectnumber+"</span>"+(""!=t?'<span class="popup__artwork-info-author">'+t+"</span>":"")+'<span class="popup__artwork-info-title">'+e.title+'</span><span class="popup__artwork-info-class">'+e.classification+'</span></div><div class="popup__btn-wrap"><a href="#" class="btn-invert btn-collection-delete">Remove Item</a></div><footer class="popup__footer"><a href="#" data-popup-close>Cancel</a></footer></section>',a.open_lightbox(a.settings.popup_markup)},open_lightbox:function(e){$.magnificPopup.open({closeOnBgClick:!1,midClick:!0,mainClass:"mfp-trans-bg",items:{type:"inline",src:e},overflowY:"scroll",removalDelay:200}),$(".btn-collection-delete").on("click",function(){a.remove_artwork()}),$("#delete-collection").find("[data-popup-close]").on("click",function(e){$.magnificPopup.close(),e.preventDefault()})}};a.init()},ham.behavior.description_list_overflow=function(){"use strict";var e=$(this);$("dd",e).each(function(){var e=$(this);e.data("fullHeight",e.innerHeight()),e.innerHeight()>200&&e.wrapInner('<div class="description-list__item-overflow" />').append('<a href="#" class="description-list__show-more"><span>Show more</span></a>')}),$(".description-list__show-more").on("click",function(e){var t=$(this),o=t.parent("dd");if(o.toggleClass("description-list__active"),o.hasClass("description-list__active")){var a=o.data("fullHeight");t.text("Show less")}else{var a="";t.text("Show more")}$(".description-list__item-overflow",o).css({"max-height":a}),e.preventDefault()})},ham.behavior.dynamic_grid=function(e,t){"use strict";function o(){ham.helper.is_mobile()?i():a(),e.removeClass("loading")}function a(){r||(e.masonry({columnWidth:e.data("sizer")||".artwork-grid__sizer",gutter:0,itemSelector:e.data("selector")||".artwork-grid__item",hiddenStyle:{opacity:0},visibleStyle:{opacity:1},ltr:e.data("ltr")||!1}),r=!0,t&&t())}function i(){r&&(e.masonry("destroy"),r=!1)}var r=!1,n=!1;e.addClass("loading"),e.imagesLoaded(function(){o(),n=!0}),$(window).on("resize",$.debounce(200,function(){n&&o()}))},ham.behavior.edit_collection=function(e){"use strict";function t(){i.parent().removeClass("collection-item--editing"),e.removeClass("active"),s=!1}function o(){var e={mycollectionid:a,mycollectiontitle:n.val()};""!=e.mycollectiontitle&&$.ajax({type:"POST",url:"/mycollection/rename",data:e,cache:!1,headers:{"X-CSRF-Token":$('meta[name="csrf-token"]').attr("content")}}).done(function(o){t(),r=e.mycollectiontitle}).fail(function(e){console.log(e)})}var a=e.data("collection"),i=e.prev("span"),r=e.prev("span").text(),n=$('<input type="text" value="'+r+'" class="collection-item__input" />'),s=!1;i.after(n),e.on("click",function(o){s?t():(i.parent().addClass("collection-item--editing"),n.focus(),e.addClass("active"),s=!0),o.stopPropagation(),o.preventDefault()}),n.on("input propertychange",function(e){i.text($(this).val())}),$(document).on("keyup",function(e){s&&(27==e.keyCode?(t(),i.text(r),n.val(r)):13==e.keyCode&&o())}),$("body").on("click",function(e){s&&o()})},ham.behavior.events_filter=function(){"use strict";var e=$(this),t=e.data("url");$("#type_selector").on("change",function(o){var a={type:$(this).val(),date:ham.events.date};ham.helper.ajax(t,a,"GET",function(t,o){e.html(o),ham.events=a,$(window).resize()})})},ham.behavior.faux_radio=function(e){"use strict";var t=$(":checkbox",e);t.on("change",function(){t.not($(this)).prop("checked",!1)})},ham.behavior.feature_grid=function(){"use strict";function e(){if(ham.helper.is_mobile())n.css({opacity:"",left:""});else{if(o==$(window).width())return;var e,a;r=i.first().width(),$.each(n,function(){t=$(this),e=r-t.width(),a=e*Math.random(),t.css({opacity:1,left:a})}),o=$(window).width()}}var t,o,a=$(this),i=$(".feature-grid__left, .feature-grid__right",a),r=i.first().width(),n=$(".feature-grid__item",a);n.first().width();e(),$(window).on("resize",$.debounce(100,e))},ham.behavior.filter_grid=function(e){"use strict";function t(){ham.helper.is_mobile()?a():o(),e.removeClass("loading")}function o(){i||(e.masonry({columnWidth:".filter-component__sizer",gutter:0,itemSelector:".filter-component__level-2",hiddenStyle:{opacity:0},visibleStyle:{opacity:1},transitionDuration:0}),i=!0)}function a(){i&&(e.masonry("destroy"),i=!1)}var i=!1;e.addClass("loading"),e.imagesLoaded(function(){t()}),$(window).on("resize",$.debounce(200,function(){t()}))},ham.behavior.gallery_label_toggle=function(e){"use strict";$(e).click(function(e){e.preventDefault(),e.stopPropagation(),$(".ifp-gallery__labeltext").toggleClass("ifp-closed").toggleClass("ifp-open"),$("#ifp_gallery__togglebutton").toggleClass("ifp-arrowdown").toggleClass("ifp-arrowup")})},ham.behavior.gallery=function(e){"use strict";function t(){p.draggable("instance")&&p.draggable("destroy").css({transform:"",width:"",top:"",left:""})}function o(){1==$(".slideshow__active-slide a",u).data("zoom-enabled")||u.length<=0&&1==p.data("zoom-enabled")?(c.removeClass("disabled"),g=!0):(c.addClass("disabled"),g=!1)}function a(e){var t=new Image;$(t).load(function(){C.w=t.width,C.h=t.height,r=C.w/k}),t.src=e}function i(){setTimeout(function(){var t=f.is(":visible")?f.outerHeight(!0):0,o=v.outerHeight(!0),a=e.innerWidth(),i=win_h,r=i-o,s=$(".hero-artwork__video",e);d.css({height:r,lineHeight:r-parseInt(d.css("padding-top"))+"px"}),$("html").hasClass("ie8")&&m.css({height:r,overflow:"hidden"}),s.length>0&&s.css({width:"",maxHeight:r-50-t}),(r-50-t)*n>a?p.css({maxWidth:"100%",maxHeight:""}):p.css({width:"",maxHeight:r-50-t})},1)}var r,n,s,l=$("[data-gallery-item]",e),c=$("[data-zoom]",e),d=$(".hero-artwork__image-wrapper",e),p=$("img",d),u=$(".slideshow-thumbs",e),m=$("figure",e),f=$("figcaption",m),h=$('<span class="hero-artwork__cursor"></span>'),_=e.closest(".artwork__wrapper").length>0?e.closest(".artwork__wrapper"):$("html, body"),v=$(".toolbox",e),g=!1,w=1,b=!1,k=p.width(),y=p.height(),C={},x=ham.helper.is_touch&&(ham.helper.is_mobile()||ham.helper.is_tablet)?"orientationchange":"resize";l.removeAttr("title"),i(),function(){l.each(function(e,t){$(t).data("renditionnumber")===p.data("renditionnumber")&&($(t).addClass("slideshow__active-slide"),s=e)})}(),o(),d.imagesLoaded(function(){n=p.width()/p.height(),e.addClass("loaded"),i(),$(".hero-artwork__loader",m).addClass("hero-artwork__loader-hide"),setTimeout(function(){k=p.width(),y=p.height(),a(p.prop("src"))},100),c.on("click",function(e){if(o){var a=$(this).data("zoom");d.addClass("hero-artwork__image-wrapper--active"),_.animate({scrollTop:0},300),b=!0,$("body").addClass("hero-artwork--zoom-active"),p.draggable("instance")||p.draggable({scroll:!1,stop:function(e,t){var o=p[0].getBoundingClientRect(),a=m.height(),i=f.length>0?f.position().top:0,r=i>0?a-i:0,n=a-r;o.width>win_w&&(o.left>0&&setTimeout(function(){p.css({left:parseInt(p.css("left"))-Math.abs(o.left)})},1),o.right-win_w<0&&setTimeout(function(){p.css({left:parseInt(p.css("left"))+Math.abs(o.right-win_w)})},1),o.top>0&&setTimeout(function(){p.css({top:parseInt(p.css("top"))-Math.abs(o.top)})},1),o.bottom-n<0&&setTimeout(function(){p.css({top:parseInt(p.css("top"))+Math.abs(o.bottom-n)})},1))}}),"in"==a?w=w>=r?r:w+.25>=r?r:w+.25:(w=1,b=!1,$("body").removeClass("hero-artwork--zoom-active")),1==w&&t(),Modernizr.csstransforms?p.css({transform:"scale("+w+") translate3d(0,0,0)"}):p.css({width:k*w,maxHeight:y*w})}e.preventDefault()}),$(window).on(x,$.debounce(200,function(){setTimeout(function(){k=p.width(),y=p.height(),i(),a(p.prop("src")),w=w>=r?r:w,b&&(Modernizr.csstransforms?p.css({transform:"scale("+w+") translate3d(0,0,0)"}):p.css({width:k*w,maxHeight:y*w}))},101)}))}),$("a",l).on("click",function(e){var r=$(this),n=r.data("object-caption"),l=r.data("object-copyright");if(t(),w=1,s=r.closest("li").index(),d.addClass("img-fade-out"),f.empty(),n&&f.append('<span class="artwork__meta">'+n+"</span>"),l&&f.append('<span class="artwork__meta">&copy; '+l+"</span>"),n||l?f.removeClass("hidden"):f.addClass("hidden"),$(".hero-artwork__video",d).remove(),"image"==r.closest("li").data("gallery-item"))p.removeClass("hidden"),setTimeout(function(){p.on("load",function(){d.removeClass("img-fade-out"),k=p.width(),y=p.height(),a(p.prop("src")),p.off("load")}).prop("src",r.prop("href")).each(function(){this.complete&&$(this).load()}),b=!1,$("body").removeClass("hero-artwork--zoom-active"),i()},100);else if("video"==r.closest("li").data("gallery-item")){var c=r.data("vimeo-id"),m='<div class="hero-artwork__video"><iframe src="//player.vimeo.com/video/'+c+'?title=0&amp;byline=0&amp;portrait=0" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>';$(".hero-artwork__image-wrapper-inner",d).prepend(m),d.removeClass("img-fade-out"),p.addClass("hidden"),b=!1,$("body").removeClass("hero-artwork--zoom-active"),i()}$(".slideshow__active-slide",u).removeClass("slideshow__active-slide"),r.closest("li").addClass("slideshow__active-slide"),o(),e.preventDefault()}),e.on({mousemove:function(t){var o=d.innerHeight()+e.offset().top
;$(t.target).parents().hasClass("toolbox")?e.removeClass("hero-artwork--show-paging"):t.pageX<=.25*win_w&&t.pageY<=o||t.pageX>=.75*win_w&&t.pageY<=o?e.addClass("hero-artwork--show-paging"):e.removeClass("hero-artwork--show-paging")},mouseleave:function(t){e.removeClass("hero-artwork--show-paging")}}),l.length&&(h.appendTo("body"),p.on({click:function(e){if(!b){var t=l.length;e.pageX>win_w/2?s==t-1?s=0:s++:0==s?s=t-1:s--,l.eq(s).find("a").click()}},mousemove:function(e){e.pageX>win_w/2?(h.addClass("hero-artwork__cursor--next"),h.removeClass("hero-artwork__cursor--prev")):(h.addClass("hero-artwork__cursor--prev"),h.removeClass("hero-artwork__cursor--next")),h.css({top:e.pageY,left:e.pageX})},mouseleave:function(e){h.css({top:"",left:""})}}))},ham.behavior.hover_intents=function(e){function t(){r||!ham.helper.is_desktop()&&!ham.helper.is_widescreen()?r&&(ham.helper.is_tablet()||ham.helper.is_mobile())&&(a(),r=!1):(o(),r=!0)}function o(){Modernizr.touch?$("> ul > li > a",e).on("click.nav_toggle",function(e){var t=$(this).parent("li");$(".sub-nav",t).length>0&&(t.siblings().removeClass("hover"),t.toggleClass("hover"),e.preventDefault())}):e.children().children().hoverIntent({over:function(e){$(e.currentTarget).addClass("hover")},out:function(e){$(e.currentTarget).removeClass("hover")},timeout:150,interval:75})}function a(){$("> ul > li > a",e).off("click.nav_toggle")}var i,r=!1;t(),$(window).on("resize",function(){clearTimeout(i),i=setTimeout(function(){t()},250)})},ham.behavior.image_request=function(e){"use strict";var t={artworks:JSON.parse($("[data-artwork-ids]",e).val())||[],init:function(){t.handle_events(),e.on("submit","form",function(e){if($("#select-object").is(":focus"))$("#search-artwork").click();else{var o=$(this).serialize();t.send_data(o)}e.preventDefault()})},handle_events:function(){var o=$("#type");o.find($("option:contains('Postcard/notecard/greeting card')")).remove(),o.find($("option:contains('Website')")).remove(),o.append($("option:contains('Other')")),$("option:contains('Other')").text("Other (please describe)"),$("#select-object").focusout(function(e){$("#search-artwork").click()}),$("#selected-artwork",e).on("artwork_added",function(o){var a={objectnumber:o.item.objectnumber,renditionnumber:o.item.renditionnumber};t.artworks.push(a),$("[data-artwork-ids]",e).val(JSON.stringify(t.artworks))}),$("#selected-artwork",e).on("artwork_removed",function(o){t.artworks=$.grep(t.artworks,function(e){return e.objectnumber!=o.artwork.objectnumber||e.renditionnumber!=o.artwork.renditionnumber}),$("[data-artwork-ids]",e).val(JSON.stringify(t.artworks))})},send_data:function(o){e.find(".control__button").addClass("btn--loading"),ham.helper.ajax("/imagerequest",o,"POST",function(o,a){e.find(".control__button").removeClass("btn--loading"),o?t.handle_success():t.handle_error(a)})},handle_success:function(t){var o=e.find(".control__button").width();e.find(".control--error").removeClass("control--error"),e.find(".control__button").width(o).addClass("btn-success").val("Sent!").prop("disabled",!0)},handle_error:function(o){var a=$(".image-request-form",e),i=$(o.responseText).find(".image-request-form");a.html(i.html()),ham.LoadBehavior(a),t.handle_events(),e.closest(".mfp-wrap").length>0?e.closest(".mfp-wrap").animate({scrollTop:$(".control--error").eq(0).position().top-120},300):$("html, body").animate({scrollTop:$(".control--error").eq(0).offset().top-120},300)}};t.init()},ham.behavior.image_zoom=function(e){"use strict";var t=$("[data-image-wrapper]",e),o=$("[data-slider]",e),a=$("img",t);e.removeClass("loaded image-zoom--no-zoom"),t.imagesLoaded(function(){var i=t.height()/2,r=t.width()/2,n=a.height()/2,s=a.width()/2;e.addClass("loaded"),a.width()>1400?(a.draggable().css({transform:"",top:-(n-i),left:-(s-r)}),o.slider({value:100,min:50,max:500,slide:function(e,t){Modernizr.csstransforms&&a.css({transform:"scale("+t.value/100+")"})}})):(e.addClass("image-zoom--no-zoom"),a.css({transform:"",top:"",left:""}))})},ham.behavior.interactive_floorplan=function(e){"use strict";function t(){$("[data-room-ignore]",e).on("click",function(){if($(this).not("path")&&(ham.helper.is_tablet()||ham.helper.is_mobile())){var t=$(this).data("room");$("html, body").animate({scrollTop:a.offset().top},300),$("[data-room]",e).removeClass("ifp-room--active"),$('[data-room="'+t+'"]',i).addClass("ifp-room--active"),$('[data-room="'+t+'"]',a).attr("class","ifp-room--active")}}),o.on({mouseenter:function(e){var t=$(this),o=t.data("room"),r=$('[data-room="'+o+'"]',a),n=r.attr("class")||"";if(l.map=$(".ifp-room--active",a),l.list=$(".ifp-room--active",i),$('[data-room="'+o+'"]',i).addClass("ifp-room--hover"),r.attr("class",n.indexOf("ifp-room--active")>=0?"ifp-room--active ifp-room--hover":"ifp-room--hover"),t.is("path")){var s=$(".ifp-room-info__inner",i),c=s.scrollTop();s.scrollTop(0);var d=$('[data-room="'+o+'"]',i).parent().position().top;s.scrollTop(c).stop(!0,!1).animate({scrollTop:d},600)}l.map&&l.list&&(l.map.attr("class",""),l.list.removeClass("ifp-room--active"))},mouseleave:function(){var t=$(this),o=t.data("room"),i=$('[data-room="'+o+'"]',a),r=i.attr("class")||"";$(".ifp-room--hover",e).removeClass("ifp-room--hover"),$(".ifp-room--hover",a).attr("class",r.indexOf("ifp-room--active")>=0?"ifp-room--active":""),l.map&&l.list&&(l.map.attr("class","ifp-room--active"),l.list.addClass("ifp-room--active"))},click:function(){l={}}})}var o=$("[data-room]",e),a=$(".ifp-floor-map",e),i=$(".ifp-room-info",e),r=$(".ifp-gallery",e),n=($("#count",r),$("#room-num",r),$("#room-title",r),$(".artwork-grid",r)),s=(n.data("room-id"),n.data("room-title"),function(e){return document.location.search.replace(/(^\?)/,"").split("&").map(function(e){return e=e.split("="),this[e[0]]=e[1],this}.bind({}))[0]}().gallery||!1),l={};!function(){o=$("[data-room]",e),a=$(".ifp-floor-map",e),i=$(".ifp-room-info",e),l={},s?($('[data-room="'+s+'"]',a).attr("class","ifp-room--active"),$('[data-room="'+s+'"]',i).addClass("ifp-room--active"),void 0!==$('[data-room="'+s+'"]',i).parent().position()&&$(".ifp-room-info__inner",i).scrollTop($('[data-room="'+s+'"]',i).parent().position().top),setTimeout(t,3e3)):t()}()},ham.behavior.lightbox_ajax=function(e){"use strict";var t=e.data("ajax-target");e.magnificPopup({type:"ajax",alignTop:!0,closeOnBgClick:!1,midClick:!0,overflowY:"scroll",removalDelay:200,mainClass:"mfp-wrap--ajax mfp-close--back",closeMarkup:'<button title="%title%" class="mfp-close">Back <i class="mfp-close-icn"></i></button>',fixedContentPos:!0,callbacks:{open:function(){$("html").addClass("mfp-ajax--open")},close:function(){$("html").removeClass("mfp-ajax--open")},parseAjax:function(e){t&&(e.data=$(e.data).find(t))},ajaxContentAdded:function(){ham.LoadBehavior(this.content)}}})},ham.behavior.load_more_articles=function(){"use strict";var e=$(this),t={settings:{url:e.data("load-url"),placeholder_url:"/assets/images/no_image_thumb.png"},opts:{page:e.data("page"),tag:e.data("tag")},init:function(){t.add_handlers()},add_handlers:function(){$("[data-trigger]",e).on("click",function(e){$(this).addClass("btn--loading"),t.opts.page++,t.get_results(),e.preventDefault()})},get_results:function(o){ham.helper.ajax(t.settings.url,t.opts,"GET",function(o,a){o&&($(".sticky-section").append(a.view),e.removeClass("loading"),$("[data-trigger]",e).removeClass("btn--loading"),t.opts.page>=a.info.pages?$("[data-trigger]",e).hide():$("[data-trigger]",e).show())})}};t.init()},ham.behavior.load_more_exhibition=function(){"use strict";var e=$(this),t={settings:{url:e.data("load-url"),placeholder_url:"/assets/images/no_image_thumb.png"},opts:{type:e.data("type")+"-exhibition",year:null,page:1},init:function(){t.add_handlers()},add_handlers:function(){$("[data-trigger]",e).on("click",function(e){$(this).addClass("btn--loading"),t.get_results(),t.opts.page++,e.preventDefault()}),$("[data-year-trigger]",e).on("change",function(o){e.addClass("loading"),t.opts.year=$(this).val(),t.opts.page=0,t.get_results(!0),t.opts.page++})},get_results:function(o){ham.helper.ajax(t.settings.url,t.opts,"GET",function(a,i){a&&(t.update_layout(i.records,o),e.removeClass("loading"),$("[data-trigger]",e).removeClass("btn--loading"),t.opts.page==i.info.pages?$("[data-trigger]",e).hide():$("[data-trigger]",e).show())})},setup_data:function(e){return $.each(e,function(e,o){if(o.begindate=moment(o.begindate).format("MMMM D, YYYY"),o.enddate=moment(o.enddate).format("MMMM D, YYYY"),o.month=moment(o.begindate).format("MMMM").toLowerCase(),o.venues){var a=o.venues.length-1;$.each(o.venues,function(e,t){a==e&&(t.last=!0)})}o.description&&(o.description=o.description.substring(0,100)+"..."),o.primaryimageurl||(o.primaryimageurl=t.settings.placeholder_url)}),e},update_layout:function(o,a){var o=t.setup_data(o),i=ham.templates.exhibition_item,r=Mustache.render(i,{array:o}),a=!0===a?"html":"append";$(".module__inner",e)[a](r)}};t.init()},ham.behavior.login_reg=function(e){"use strict";var t=e.data("type");switch(t){case"login":var o="/user/login",a="Logging in";break;case"register":var o="/user",a="Registering";break;case"reset":var o="/user/forgot",a="Resetting"}var i={errors:0,init:function(){e.data("login_reg",!0),$("form",e).on("submit",function(e){var t=i.get_data();i.send_data(t),e.preventDefault()})},get_data:function(){var t={};return i.errors=0,$(".msg-error",e).remove(),$(":input",e).not('[type="submit"]').each(function(){var o=$(this),a=o.prop("name");o.attr("required")&&i.validate_field(o)&&i.errors++,a&&(o.is(":checkbox")?t[a]=$(':checked[name="'+a+'"]',e).val()||"":t[a]=o.val())}),t},send_data:function(r){0==i.errors&&ham.helper.ajax(o,r,"POST",function(o,r){o?($(".form-row--submit .control",e).append('<span class="control__button--invert btn-success">'+a+"</span>").find(":submit").hide(),"login"==t&&(i.update_header(r),ham.user=r),setTimeout(function(){$.magnificPopup.close()},500),setTimeout(function(){$(".form-row--submit .btn-success",e).remove(),$(".form-row--submit :submit",e).show(),"login"==t&&$("#tour-viewer").length>0&&location.reload()},700)):$.isArray(r.responseJSON)?$.each(r.responseJSON,function(t,o){$("form",e).prepend('<span class="msg-error">'+o+"</span>")}):$("form",e).prepend('<span class="msg-error">'+r.responseText+"</span>")})},update_header:function(e){var t=$(".nav-secondary ul").not(".opening-info"),o='<li>Welcome <a href="/profile/'+e.username+'/mycollections" class="nav-secondary__profile">'+e.name+'</a></li><li><a href="/user/logout">Logout</a></li>';t.html(o)},validate_field:function(t){var o=!1;if("email"==t.attr("type"))i.validate_email(t.val())&&""!=t.val()?o=!1:(o=!0,$("form",e).prepend('<span class="msg-error">Please enter a valid email address</span>'));else if(t.is(":radio")){var a=$(':checked[name="'+t.prop("name")+'"]',e);o=a.length<=0}else o=""==t.val();return o?t.closest(".control").addClass("control--error"):t.closest(".control").removeClass("control--error"),o},validate_email:function(e){return/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)}};e.data("login_reg")||ham.helper.is_mobile()||i.init()},ham.behavior.map=function(e){"use strict";e.on({mousedown:function(t){$(".map__overlay",e).css({pointerEvents:"none"})},mouseleave:function(){$(".map__overlay",e).css({pointerEvents:""})}})},ham.behavior.mask_email=function(e){var t=e.data("user")||!1,o=e.data("domain")||!1;t&&o&&e.attr("href","mailto:"+t+"@"+o).text(t+"@"+o)},ham.behavior.master_tours=function(e){"use strict";var t={els:{list:$(".master-tours",e)},init:function(){ham.helper.ajax("/master_tours",null,"GET",function(e,o){if(e){$.each(o,function(e,t){t.description=t.description.substring(0,40)+"..."});var a=$.parseHTML(Mustache.render(ham.templates.master_tour,o));t.els.list.html(a),t.load_master()}})},load_master:function(){t.els.list.on("click","a",function(e){var t=$(this),o=t.data("tour-id");ham.helper.ajax("/tour/"+o+"/clone",null,"GET",function(e,t){e&&(window.location="/tours/"+t.id+"/edit")}),e.preventDefault()})}};e.is(":visible")&&t.init()},ham.behavior.modal=function(e){"use strict";var t=e.data("modal-src"),o="#"+$(t).find(".form-row:first input").attr("id"),a=e.data("modal-class"),i={beforeOpen:function(){$(window).width()<768?this.st.focus=!1:this.st.focus=o},open:function(){ham.LoadBehavior(t),$(t).find("[data-popup-close]").on("click",function(e){$.magnificPopup.close(),e.preventDefault()})}};ham.helper.inline_popup(e,t,o,i,a)},ham.behavior.nav_mobile_toggle=function(e){"use strict";function t(){c||!ham.helper.is_tablet()&&!ham.helper.is_mobile()?c&&(ham.helper.is_desktop()||ham.helper.is_widescreen())&&(r(),c=!1):(o(),c=!0)}function o(){e.on("click.nav_mobile_toggle",function(e){e.preventDefault(),$("html").hasClass("mobile-nav-active")?i():a()})}function a(){l=$(window).scrollTop(),$("html").addClass("mobile-nav-active"),s=setTimeout(function(){$("html").addClass("no-scroll")},150),$("#nav-mobile .nav-primary > ul > li > a").on("click.nav_mobile_toggle",function(e){var t=$(this);t.next().is(".sub-nav")&&($("h2",t.parent()).append('<a href="#">Back</a>'),t.parent().addClass("active"),$("#nav-mobile").addClass("sub-nav-active"),e.preventDefault())}),$("#nav-mobile .sub-nav__links h2").on("click.nav_mobile_toggle","a",function(e){e.preventDefault();var t=$(this);$("#nav-mobile").removeClass("sub-nav-active"),t.parents("li.active").removeClass("active").end().remove()})}function i(){$("html").removeClass("mobile-nav-active no-scroll"),clearTimeout(s),$(window).scrollTop(l),$("#nav-mobile").removeClass("sub-nav-active"),$("#nav-mobile .nav-primary > ul > li").removeClass("active").find("h2 a").remove(),$("#nav-mobile .nav-primary > ul > li > a").off("click.nav_mobile_toggle"),$("#nav-mobile .sub-nav__links h2").off("click.nav_mobile_toggle","a")}function r(){i(),e.off("click.nav_mobile_toggle")}var n,s,l,c=!1;t(),$(window).on("resize",function(){clearTimeout(n),n=setTimeout(t,250)})},ham.behavior.nav_site_search_sticky=function(e){function t(){l||!ham.helper.is_desktop()&&!ham.helper.is_widescreen()?l&&(ham.helper.is_tablet()||ham.helper.is_mobile())&&(i(),l=!1):(a(),l=!0)}function o(){ham.helper.is_mobile()?$(".sticky-heading-search-form input[type=text]").attr("placeholder",c.mobile):$(".sticky-heading-search-form input[type=text]").attr("placeholder",c.desktop)}function a(){function t(){return $("html").hasClass("desktop-sticky-search-active")}function o(t){($("body").hasClass("index-mag")&&$(".sticky-heading").hasClass("sticky")||$("body").hasClass("index-mag")&&ham.helper.is_touch)&&($("html").addClass("desktop-sticky-search-active"),n.val(t).focus(),e.siblings(".hover").removeClass("hover"),$(window).scrollTop())}function a(){$("html").removeClass("desktop-sticky-search-active"),n.length>0&&n.blur().val("")}if(n=$(".sticky-heading-search-form input[type=text]"),s=$("a",e),n.on("focus.nav_site_search_sticky",function(e){$("html").addClass("desktop-sticky-search-active")}),s.on("click.nav_site_search_sticky",function(e){e.preventDefault(),t()?a():o()}),!Modernizr.touch){var i=!1;$(document).on("keydown.nav_site_search_sticky",function(e){93!=e.keyCode&&17!=e.keyCode||(i=!0)}),$(document).on("keyup.nav_site_search_sticky",function(e){if(93!=e.keyCode&&17!=e.keyCode||(i=!1),!$(e.target).is("input")&&!$(e.target).is("textarea")&&(!t()&&!i&&e.keyCode>=65&&e.keyCode<=90||e.keyCode>=48&&e.keyCode<=57&&27!=e.keyCode)){o(String.fromCharCode(e.keyCode))}t()&&27==e.keyCode&&a()})}$(document).on("hide_nav_site_search",function(e){a()})}function i(){$("html").removeClass("desktop-sticky-search-active"),n.length>0&&n.blur().val("").off("keyup.nav_site_search_sticky, focus.nav_site_search"),Modernizr.touch||$(document).off("keyup.nav_site_search_sticky focus.nav_site_search_sticky"),s.off("click.nav_site_search_sticky"),$(document).off("hide_nav_site_search")}var r,n,s,l=!1,c={mobile:"Gallery Number, Artist, Keyword, Title",desktop:"Search by keyword, title, artist, object number, or gallery number"};t(),o(),$(window).on("resize",function(){clearTimeout(r),r=setTimeout(function(){t(),o()},250)})},ham.behavior.nav_site_search=function(e){function t(){l||!ham.helper.is_desktop()&&!ham.helper.is_widescreen()?l&&(ham.helper.is_tablet()||ham.helper.is_mobile())&&(i(),l=!1):(a(),l=!0)}function o(){ham.helper.is_mobile()?$(".search-form input[type=text]").attr("placeholder",c.mobile):$(".search-form input[type=text]").attr("placeholder",c.desktop)}function a(){function t(){return $("html").hasClass("desktop-search-active")}function o(t){($("body").hasClass("home")&&$(".page-header").hasClass("page-header--fixed")||$("body").hasClass("home")&&ham.helper.is_touch||!$("body").hasClass("home"))&&($("html").addClass("desktop-search-active"),n.val(t).focus(),e.siblings(".hover").removeClass("hover"),$(window).scrollTop())}function a(){$("html").removeClass("desktop-search-active"),n.length>0&&n.blur().val("")}if(n=$(".search-form input[type=text]"),s=$("a",e),n.on("focus.nav_site_search",function(e){$("html").addClass("desktop-search-active")}),s.on("click.nav_site_search",function(e){e.preventDefault(),t()?a():o()}),!Modernizr.touch){var i=!1;$(document).on("keydown.nav_site_search",function(e){93!=e.keyCode&&17!=e.keyCode||(i=!0)}),$(document).on("keyup.nav_site_search",function(e){if(93!=e.keyCode&&17!=e.keyCode||(i=!1),!$(e.target).is("input")&&!$(e.target).is("textarea")&&(!t()&&!i&&e.keyCode>=65&&e.keyCode<=90||e.keyCode>=48&&e.keyCode<=57&&27!=e.keyCode)){o(String.fromCharCode(e.keyCode))}t()&&27==e.keyCode&&a()})}$(document).on("hide_nav_site_search",function(e){a()})}function i(){$("html").removeClass("desktop-search-active"),n.length>0&&n.blur().val("").off("keyup.nav_site_search, focus.nav_site_search"),Modernizr.touch||$(document).off("keyup.nav_site_search focus.nav_site_search"),s.off("click.nav_site_search"),$(document).off("hide_nav_site_search")}var r,n,s,l=!1,c={mobile:"Gallery Number, Artist, Keyword, Title",desktop:"Search by keyword, title, artist, object number, or gallery number"};t(),o(),$(window).on("resize",function(){clearTimeout(r),r=setTimeout(function(){t(),o()},250)})},ham.behavior.open_pdf=function(e){"use strict";var t=$(e).prop("href");$(e).on("click",function(e){e.stopPropagation(),window.open(t),e.preventDefault()})},ham.behavior.openseadragon=function(e){"use strict";function t(){osd_viewer&&(osd_viewer.viewport.zoomBy(I.zoomPerClick),osd_viewer.viewport.applyConstraints()),_=osd_viewer.viewport.getZoom()}function o(){osd_viewer&&(osd_viewer.viewport.zoomBy(1/I.zoomPerClick),osd_viewer.viewport.applyConstraints()),_===osd_viewer.viewport.getZoom()&&a(),(_=osd_viewer.viewport.getZoom())<=I.minZoomLevel+.3&&a()}function a(){q=!1,k.show(),b.removeClass("osd__wrapper--active")}function i(){q=!0,k.hide(),b.addClass("osd__wrapper--active")}function r(){w.imagesLoaded(function(){g.addClass("loaded")})}function n(e){T.attr("href",e)}function s(){$(".hero-artwork__loader",g).addClass("hero-artwork__loader-hide"),l(),osd_viewer=OpenSeadragon(I),c(m),r()}function l(){osd_viewer&&(osd_viewer.destroy(),osd_viewer=null)}function c(e){if(osd_viewer){osd_viewer.addOnceHandler("open",function(){var e=osd_viewer.world.getItemAt(0);e.getFullyLoaded()?osd_viewer.viewport.applyConstraints():e.addOnceHandler("fully-loaded-change",function(){osd_viewer.viewport.applyConstraints()})}),osd_viewer.addHandler("open",function(){0==h&&(S=osd_viewer.viewport.getContainerSize().x,osd_viewer.viewport.zoomTo(p/S,null,!1))}),osd_viewer.addOnceHandler("open-failed",function(){console.warn("OSD - Error while loading Json")});var t=function(e){var t=e["@id"];if(1==varnishEnabled&&(console.log("Inside rewrite conditional"),t=t.replace(/https?:\/\/[^\/]+/i,varnishURL),e["@id"]=t),0==h){var o=e.width,a=e.height;o>a?(e.width=256,e.height=Math.ceil(a*(256/o))):(e.width=Math.ceil(o*(256/a)),e.height=256)}p=e.width,u=e.height,osd_viewer.open(e)},o="https://idscache.harvardartmuseums.org/ids/iiif/"+e+"/info.json";if(1==varnishEnabled)var o="https://idscache.harvardartmuseums.org/ids/iiif/"+e+"/info.json";else var o="https://ids.lib.harvard.edu/ids/iiif/"+e+"/info.json";$.getJSON(o,t)}}function d(){var e=D.is(":visible")?D.outerHeight(!0):0,t=z.outerHeight(!0),o=win_h-t;w.css({height:o}),b.css({height:o-e})}var p,u,m=e.data("initial-image-id"),f=e.data("initial-image-href"),h=e.data("zoom-enabled"),_=-999,v=ham.helper.is_touch&&(ham.helper.is_mobile()||ham.helper.is_tablet)?"orientationchange":"resize",g=e.closest("[data-artwork-wrapper]"),w=$(".hero-artwork__image-wrapper",g),b=$(".osd__wrapper",g),k=$(".osd__overlay",g),y=$('[data-zoom="in"]',g),C=$('[data-zoom="out"]',g),x=$('<span class="hero-artwork__cursor"></span>'),T=$("[data-download]",g),j=$(".openseadragon__thumb",g),D=$("figcaption",g),z=$(".toolbox",g),S=b.width(),M=e.attr("id"),q=!1,L=0,O=j.length,I={id:M,prefixUrl:"/assets/images/openseadragon/",autoHideControls:!1,showRotationControl:!1,springStiffness:15,visibilityRatio:1,zoomPerScroll:1,zoomPerClick:1.3,immediateRender:!1,constrainDuringPan:!0,animationTime:1.5,showHomeControl:!1,showFullPageControl:!1,showNavigationControl:!1,navigatorAutoFade:!1,minZoomLevel:0,minZoomImageRatio:.8,defaultZoomLevel:0,gestureSettingsMouse:{scrollToZoom:!1}};if(0==h&&(I.maxZoomLevel=0,I.minZoomLevel=0,I.defaultZoomLevel=.16),w.addClass("hero-artwork__image-wrapper--active hero-artwork__image-wrapper--osd"),d(),s(),function(){1==h?(y.removeClass("disabled"),C.removeClass("disabled"),T.removeClass("disabled")):(y.addClass("disabled"),C.addClass("disabled"),T.addClass("disabled"))}(),n(f),$(window).on(v,$.debounce(200,function(){d()})),g.on({mousemove:function(e){var t=w.innerHeight()+g.offset().top;$(e.target).parents().hasClass("toolbox")?g.removeClass("hero-artwork--show-paging"):e.pageX<=.25*win_w&&e.pageY<=t||e.pageX>=.75*win_w&&e.pageY<=t?g.addClass("hero-artwork--show-paging"):g.removeClass("hero-artwork--show-paging")},mouseleave:function(e){g.removeClass("hero-artwork--show-paging")}}),y.click(function(e){if(e.preventDefault(),y.hasClass("disabled"))return!1;i(),t()}),C.click(function(e){if(e.preventDefault(),y.hasClass("disabled"))return!1;i(),o()}),O){var P=j.length;x.appendTo("body"),j.click(function(e){e.preventDefault();var t=$(this);h=t.data("zoom-enabled"),m=t.data("image-id"),I.maxZoomLevel=null,I.minZoomLevel=null,l(),s(),n(t.attr("href"))}),k.on({click:function(e){q||(e.pageX>win_w/2?L==P-1?L=0:L++:0==L?L=P-1:L--,j.eq(L).click())},mousemove:function(e){e.pageX>win_w/2?(x.addClass("hero-artwork__cursor--next"),x.removeClass("hero-artwork__cursor--prev")):(x.addClass("hero-artwork__cursor--prev"),x.removeClass("hero-artwork__cursor--next")),x.css({top:e.pageY,left:e.pageX})},mouseleave:function(e){x.css({top:"",left:""})}})}else k.addClass("osd__overlay--nothumbs")},ham.behavior.powerpoint_request=function(e){"use strict";var t={init:function(){e.one("click",function(o){var a=new FormData,i=e.data("mycollectionid"),r=e.data("objectcount"),n=e.data("userid"),s=e.data("slug");a.append("mycollectionid",i),a.append("userid",n),a.append("slug",s),t.send_data(a,r),o.preventDefault(),e.on("click",function(e){e.preventDefault()})})},send_data:function(e,o){o>50?ham.helper.file_ajax("/powerpointrequest",e,"POST",function(e,o){e?t.handle_warning():t.handle_error(o)}):ham.helper.file_ajax("/powerpointrequest",e,"POST",function(e,o){e?t.handle_success():t.handle_error(o)})},handle_success:function(){alert("The request was submitted successfully. You will get an email with a link to your presentation file in about 5 minutes.")},handle_warning:function(){alert("The request was submitted successfully. However, your collection contains more than 50 objects and may not work. You will get an email with a link to your presentation file in about 5 minutes. If the download link does not work, reduce the size of your collection and try again.")},handle_error:function(e){alert("The request failed. Please try again later.")}};t.init()},ham.behavior.press_filter=function(){"use strict";var e=$(this),t=e.data("url");$("#year_selector").on("change",function(e){$.ajax({url:t,data:{year:$(this).val()},success:function(e){$(".press_material").remove(),$("#press_container").append(e)}})})},ham.behavior.search=function(e){"use strict";var t=!0,o={filter_on_init:!!e.data("filters-url"),lock_base_filter:!!e.data("lock-base"),base_query:e.data("base-query"),settings:{url:"/browse",results_box:$("[data-search-results]",e),sizer:$('<div class="artwork-grid__sizer"></div>'),throttle:500,load_offset:500,page_loaded:!1,per_page:12,preload:void 0===e.attr("data-preload")||e.data("preload"),placeholder_url:"/assets/images/no_image_thumb.png",lazyload:e.data("lazyload")||!1,scrollload:e.data("scrollload"),load_more:$('<a href="#" class="artwork-grid__load-more">Load more</a>')},default_placeholders:{mobile:"Gallery Number, Artist, Keyword, Title",desktop:"Search by keyword, title, artist, object number, or gallery number"},page:0,pages:0,num_items:0,is_in_tour:!!e.data("tour-viewer"),default_filter:{q:"",classification:[],worktype:[],technique:[],medium:[],period:[],place:[],century:[],culture:[],color:[],onview:[],custom:{}},standard_filter:{load_amount:e.data("load_amount")||12,offset:0,gallery:e.data("room-id")||[],person:e.data("person-id")||[]},blurred:!1,filter_not_clone:$(".browse-module__form-filters").not(".browse-module__form-filters--clone"),init:function(){function a(e){$.each(e,function(e,t){if(t instanceof Array)t.forEach(function(t){o.find_and_update_filter(e,t)});else if(t&&t.constructor===Object)a(t);else{if("q"===e&&0===t)return;o.filter[e]=t}}),!!e.q&&!o.base_query&&i.val(e.q)}ham.helper.is_touch||o.base_query||o.focus_input();var i=$('input[name="q"]',e);o.add_handlers(),o.make_sticky(),o.update_placeholder(i),o.filter=o.retrieve_filters(),e.data("module-url")&&(o.module_url=e.data("module-url").replace(/http.+\?/,"")),$(window).on("resize",$.debounce(200,function(){o.update_placeholder(i)})),$('input[name="group"]',e).length>0&&(o.filter.group=$('input[name="group"]',e).val()),$('input[name="sort"]',e).length>0&&(o.filter.sort=$('input[name="sort"]',e).val());var i=$('input[name="q"]',e),r=o.module_url?o.data_from_url(o.module_url):o.data_from_url();if(o.settings.preload)if(o.filter_on_init)ham.helper.ajax(e.data("filters-url"),null,"GET",function(e,t){e&&(t=r||t,a(t),o.get_results(o.filter))});else if(!o.filter.gallery instanceof Array)o.get_results(o.filter);else if(r){if(a(r),o.base_query){var n=$(".filter-component__selected-filters",e);$("<li>").addClass("disabled").append("<a>").prop("href","#").text(o.base_query.toLowerCase()).insertAfter($("li:first-child",n)),n.hasClass("hidden")&&n.removeClass("hidden")}o.get_results(o.filter)}else""==i.val()?o.setup_grid():(o.filter.q=i.val(),o.get_results(o.filter));t=!1},focus_input:function(){$('input[name="q"]',o.filter_not_clone).length>0&&(ham.helper.is_inview($(".browse-module__input-wrapper",o.filter_not_clone),-75)?o.blurred||($('input[name="q"]',o.filter_not_clone).focus(),o.blurred=!0):($('input[name="q"]',o.filter_not_clone).blur(),o.blurred=!1))},add_handlers:function(){$("[data-filter] a:not(.filter-component__more-link, .filter-component__more-link2)",e).on("click",function(t){var a=$(this).parent(),i=void 0!==a.data("type")?a.data("type"):a.parents(".filter-component__children").data("filter"),r=a.data("filter");a.hasClass("filter-component--selected")?o.remove_filter(i,r):o.add_filter(i,r,a),o.settings.page_loaded=!1,$(".filter-component__parent--active a",e).click(),o.get_results(o.filter),t.preventDefault()}),$(".filter-component__more-link",e).on("click",function(e){var t=$(this),o=t.next("ul"),a=(t.closest(".filter-component__js-grid"),t.closest(".filter-component__level-2")),i=a.siblings(".filter-component__level-2").filter(function(){return parseInt($(this).css("left"))==parseInt(a.css("left"))&&parseInt($(this).css("top"))>parseInt(a.css("top"))});console.log("Col_items:"),console.log(i),o.hasClass("toggle-target--active")?(t.text("More").removeClass("toggle--active"),i.each(function(){var e=parseInt($(this).css("top"));$(this).css({top:e-o.outerHeight(!0)})}),o.removeClass("toggle-target--active")):(t.text("Less").addClass("toggle--active"),o.addClass("toggle-target--active"),i.each(function(){var e=parseInt($(this).css("top"));$(this).css({top:e+o.outerHeight(!0)})})),e.preventDefault()}),$(".filter-component__more-link2",e).on("click",function(e){var t=$(this),o=t.next(),a=(t.closest(".filter-component__js-grid"),t.closest(".filter-component__level-2")),i=a.siblings(".filter-component__level-2").filter(function(){return parseInt($(this).css("left"))==parseInt(a.css("left"))&&parseInt($(this).css("top"))>parseInt(a.css("top"))});console.log("Col_items:"),console.log(i),o.hasClass("toggle-target--active")?(t.text("More").removeClass("toggle--active"),i.each(function(){var e=parseInt($(this).css("top"));$(this).css({top:e-o.outerHeight(!0)})}),o.removeClass("toggle-target--active")):(t.text("Less").addClass("toggle--active"),o.addClass("toggle-target--active"),i.each(function(){var e=parseInt($(this).css("top"));$(this).css({top:e+o.outerHeight(!0)})})),e.preventDefault()}),$('input[name="q"]',e).bind("input propertychange",$.throttle(o.settings.throttle,!1,function(t){var a=$('input[name="q"]',e),i=a.val();o.base_query&&(i+=" "+o.base_query),o.filter.q=i,""==i?a.removeClass("browse-module__input-text--hasvalue"):a.addClass("browse-module__input-text--hasvalue"),o.reset_paging(),o.get_results(o.filter),t.preventDefault()})),$("form",e).on("submit",function(t){$('input[name="q"]',e).trigger("input").blur(),t.preventDefault()}),$(".filter-component__parents li a",e).not("[data-filter] a").on("click",function(e){var t=$(this).prop("hash"),a=$(t).find(".filter-component__js-grid > ul");o.toggle_filter_view(t,$(this)),a.data("masonry")||ham.behavior.filter_grid.apply(a,[a]),e.preventDefault()}),$(".filter-component__close",e).on("click",function(t){var a=$(".filter-component__parent--active a"),i=a.prop("hash");o.toggle_filter_view(i,a),$(".filter-component",e).removeClass("filter-component__filter--active"),setTimeout(function(){$(".filter-component",e).removeClass("filter-component__filter--fade")},301),t.preventDefault()}),$(".filter-component__selected-filters",e).on("click","a",function(e){var t=$(this).parent(),a=t.data("group"),i=t.data("filter");t.hasClass("disabled")||(o.remove_filter(a,i),o.get_results(o.filter),e.preventDefault())}),$(window).on("scroll",$.throttle(100,function(){console.log("behavior.settings.scrollload "+o.settings.scrollload),0==o.settings.scrollload?o.settings.results_box.after(o.settings.load_more):(!o.settings.lazyload||o.page<o.settings.lazyload)&&(o.scroll_load($(window).scrollTop()),o.settings.load_more.remove()),ham.helper.is_touch||o.base_query||o.focus_input()})),e.on("click",".artwork-grid__load-more",function(e){var t=o.settings.results_box.offset().top+o.settings.results_box.outerHeight();o.filter.load_amount=30,o.scroll_load(t),e.preventDefault()}),$(".filter-component__adv-search",e).on("click",function(t){$(".filter-component__mobile",e).toggleClass("filter-component__mobile--show"),t.preventDefault()}),$(".filter-component__mobile select",e).on("change",function(){var e=$(this),t=void 0!==e.find(":selected").data("type")?e.find(":selected").data("type"):e.data("filter"),a=e.val(),i=$('.filter-component__children [data-filter="'+a+'"]');"#"!=a?(o.add_filter(t,a,i),i.addClass("filter-component--selected"),e.val("#")):(o.remove_filter(t,a),i.removeClass(selected_class)),o.get_results(o.filter)}),$("[data-room]").not("[data-room-ignore]").on("click",function(e){if($(this).is("path")){var t=$(this).data("room"),o=$(".ifp-room-info"),a=$('[data-room="'+t+'"]',o).prop("href");window.location=a}})},add_filter:function(e,t,a){var i=o.get_filter_set(e);"*"==t?i[e]=[]:(i[e]||(i[e]=[]),i[e].push(t),o.add_selected_filter(e,a)),a.addClass("filter-component--selected"),o.reset_paging()},find_and_update_filter:function(e,t){var a,i="medium"===e||"technique"===e?"mediumtechnique":e
;a="onview"==i?$('.filter-component__parents li[data-type="'+i+'"]').eq(0):$('.filter-component__children[data-filter="'+i+'"] [data-filter="'+t+'"]'),o.add_filter(e,t,a)},add_selected_filter:function(a,i){var r=$(".filter-component__selected-filters",e),n=i.clone().data("group",a).removeClass("filter-component--selected");!t||t&&!o.lock_base_filter?(n.find("a:first-child").append('<i class="icn-remove-small" />'),n.find("a:nth-child(2)").remove(),n.children("ul").remove()):n.addClass("disabled"),n.appendTo(r).nextAll().remove(),r.removeClass("hidden")},remove_filter:function(e,t){var a=o.get_filter_set(e),i=$.inArray(t,a[e]),r=$('.filter-component__selected-filters [data-filter="'+t+'"]');i>=0&&(a[e].splice(i,1),o.remove_selected_filter(e,t,r)),r.removeClass("filter-component--selected"),o.reset_paging()},remove_selected_filter:function(t,o,a){var i=$(".filter-component__selected-filters",e),r=a.data("group"),n=$('[data-filter*="'+r+'"]',e),s=$('[data-filter="'+o+'"]',n);$('.filter-component__parents [data-filter="'+o+'"].filter-component--selected').removeClass("filter-component--selected"),s.removeClass("filter-component--selected"),a.remove(),$("li[data-filter]",i).length<=0&&i.addClass("hidden")},get_filter_set:function(e){return void 0!==$('[data-custom-filter-type="'+e.replace(/\./g,"\\.")+'"]').data("custom-filter")?o.filter.custom:o.filter},toggle_filter_view:function(t,o){var a=$(t.replace(/\./g,"\\.")),i=o.parents(".filter-component"),r=$(".filter-component__parents",i),n=($(".filter-component__children",i),$("> div > ul",a)),s="filter-component__parent--active",l="filter-component__children--show";a.hasClass(l)?(i.removeClass("filter-component__filter--active"),i.removeClass("filter-component__filter--fade"),setTimeout(function(){n.css({display:""})},300),$(".artwork-grid",e).removeClass("drawer-open")):($("."+l,i).removeClass(l),i.addClass("filter-component__filter--active"),n.show(),$(".artwork-grid",e).addClass("drawer-open"),setTimeout(function(){i.addClass("filter-component__filter--fade")},300)),a.toggleClass(l),setTimeout(function(){$("ul",i).not(n).css({display:""})},300),o.parent("li").hasClass(s)||$("."+s,r).removeClass(s),o.parent("li").toggleClass(s)},update_counter:function(t){var o=$("[data-artwork-counter]",e),t=t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),a=1===t?" Work":" Works";o.text("Showing "+t+a)},parse_results:function(e){var t=[];return $.each(e,function(e,o){$(this).hasClass("artwork-grid__item")&&t.push(o)}),t},get_template:function(e){$.each(e,function(e,t){0!=t.imagepermissionlevel&&(t.no_pin="nopin=nopin"),ham.user&&(t.logged_in=!0)});var t=o.is_in_tour?ham.viewer.templates.collection_item:ham.templates.collection_item;return $.parseHTML(Mustache.render(t,{array:e}))},update_grid:function(e,t){var a=o.settings.results_box,i=$(e),r=$(".artwork-grid__item",a);!0===t?o.append_to_grid(i):o.add_to_grid(r,i)},add_to_grid:function(e,t){var a=o.settings.results_box;a.addClass("loading"),e.remove(),a.data("masonry")&&a.masonry("destroy"),a.prepend(t),a.data("masonry")?t.imagesLoaded(function(){a.masonry("prepended",t),a.removeClass("loading"),setTimeout(function(){o.settings.page_loaded=!0},500),ham.LoadBehavior(t)}):(ham.behavior.dynamic_grid.apply(a,[a,function(){o.settings.page_loaded=!0}]),ham.LoadBehavior($("> div",a)))},append_to_grid:function(e){console.log("appendtogrid");var t=o.settings.results_box,a=$('<div class="loader" />');t.addClass("loading-more").append([e,a]),e.css({opacity:0}),e.imagesLoaded(function(){ham.helper.is_mobile()||t.masonry("appended",e),e.css({opacity:""}),a.remove(),t.removeClass("loading-more"),o.settings.page_loaded=!0,ham.LoadBehavior(e),o.settings.lazyload&&o.settings.lazyload==o.page&&o.page!=o.pages-1&&o.settings.results_box.after(o.settings.load_more)})},setup_grid:function(){$.getJSON("/browse").success(function(e){o.update_results(e)}).error(function(){return!1})},get_results:function(e,t){ham.helper.ajax(o.settings.url,e,"GET",function(a,i){if(a){var r=$('<div class="search-results-error">Sorry, we couldnt find any results matching your criteria. Why not try removing some filters or searching by a different keyword in the field above?</div>');if(o.pages=i.info?Math.ceil(i.info.totalrecords/i.info.totalrecordsperquery):null,$(".search-results-error").remove(),i.records&&i.records.length>0?(o.settings.results_box.show(),o.update_results(i,t)):o.page>0&&o.page==o.pages?(o.settings.results_box.removeClass("loading-more"),console.log("END")):(o.settings.page_loaded=!1,o.update_counter(0),o.settings.results_box.hide().before(r)),history.pushState&&!o.is_in_tour){var n=o.build_url(e);window.history.pushState({path:n},"",n)}}})},setup_data:function(e){return $.each(e.records,function(e,t){if(t.position=o.num_items+e,t.people){var a=t.people.length-1;$.each(t.people,function(e,t){a==e&&(t.last=!0)})}t.primaryimageurl||(t.primaryimageurl=o.settings.placeholder_url)}),e},scroll_load:function(t){console.log("scroll_load"),e.offset().top+e.innerHeight()-(win_h+t)<=o.settings.load_offset&&o.settings.page_loaded&&(o.settings.page_loaded=!1,o.page++,o.filter.offset=$(".artwork-grid__item",e).length,o.num_items=o.filter.offset,o.get_results(o.filter,!0))},reset_paging:function(){o.page=0,o.filter.offset=0,o.filter.load_amount=12,o.num_items=0},update_results:function(t,a){var t=o.setup_data(t),i=o.get_template(t.records),r=o.parse_results(i);o.update_grid(r,a),o.update_counter(t.info.totalrecords),$(".artwork-grid__item",e).length>=t.info.totalrecords&&(o.settings.load_more.remove(),console.log("END CLICK"))},make_sticky:function(){function t(){1==e.data("sticky")&&($(window).on("resize",function(){clearTimeout(s),s=setTimeout(function(){t()},250)}),ham.helper.is_mobile()?c&&(ham.helper.is_tablet()||ham.helper.is_mobile())&&(r(),$(window).off("scroll.sticky_search"),c=!1):(a(),c||(i(),c=!0,setTimeout(a,500))))}function a(){l=e.offset().top+p.outerHeight(!0)+50}function i(){$(window).on("scroll.sticky_search",function(){var t=$(window).scrollTop();t>=l&&!d?ham.helper.is_touch?(e.addClass("show-top-button"),d=!0):n():t<l&&d&&(ham.helper.is_touch?(e.removeClass("show-top-button"),d=!1):r())})}function r(){e.addClass("js-fade-out_form"),setTimeout(function(){e.removeClass("js-fade-out_form js-fix_form"),o.remove_clone(),p.css({width:""}).removeClass("browse-module__form-filters--fixed")},200),d=!1}function n(){u.is(":visible")&&u.click(),o.create_clone(),e.addClass("js-fix_form"),p.css({width:e.width()}).addClass("browse-module__form-filters--fixed"),$.event.trigger({type:"hide_nav_site_search"}),d=!0}var s,l,c=!1,d=!1,p=$(".browse-module__form-filters",e),u=($('<div class="browse-module__fixed-placeholder" />'),$(".page-header"),$(".filter-component__close",e));t()},create_clone:function(){if(e.find(".browse-module__form-filters--clone").length>0)$(".browse-module__form-filters--clone",e).show();else{$(".browse-module__form-filters",e).clone().addClass("browse-module__form-filters--clone").insertAfter($(".browse-module__form-filters",e))}},remove_clone:function(){$(".browse-module__form-filters--clone",e).hide()},update_placeholder:function(t){var a,i=e.data("placeholder");a=i||(ham.helper.is_mobile()?o.default_placeholders.mobile:o.default_placeholders.desktop),t.attr("placeholder",a)},data_from_url:function(e){e||(e=window.location.search);var t=decodeURIComponent(e).replace(/\+/g," ").replace(/\?/,"");if(t){var o={},a=t.split("&");return $.each(a,function(e,t){var a=t.split("="),i=isNaN(Number(a[1]))?a[1]:Number(a[1]);if("[]"===a[0].slice(-2)){var r,n;"custom"===a[0].slice(0,6)?(n="custom[person]".split("[")[1].slice(0,-1),o.custom||(o.custom={}),r=o.custom):(n=a[0].replace("[]",""),r=o),r.hasOwnProperty(n)?r[n].push(i):r[n]=[i]}else["load_amount","offset","_"].indexOf(a[0])<0&&(o[a[0]]=i)}),o}return!1},build_url:function(e){var t=window.location.protocol+"//"+window.location.host+window.location.pathname+"?",o=$.extend({},!0,e);return delete o.load_amount,delete o.offset,t+$.param(o)},retrieve_filters:function(){var e={},t=$("a",".filter-component__parents li");return $.each(t,function(t,a){var i=$(a),r=i.prop("href").split(/\#filter-/)[1];if(i.is("[data-custom-filter]"))e.custom||(e.custom={}),e.custom[r]=[];else if(o.default_filter.hasOwnProperty(r))e[r]=o.default_filter[r];else if("mediumtechnique"===r)["medium","technique"].forEach(function(t){e[t]=o.default_filter[t]});else{var n=i.closest("li").data("type");e[n]||(e[n]=o.default_filter[n])}}),$.extend(e,o.standard_filter)}};o.init()},ham.behavior.select_artwork=function(e){"use strict";var t=$("#select-by-id",e),o=($("#select-by-collection",e),!0===e.data("enable-thumbs")),a=!0===e.data("allow-no-img"),i={artworks:JSON.parse($("[data-artwork-ids]",e).val())||[],init:function(){i.search_artwork(),i.add_collection(),i.remove_artwork()},add_collection:function(){$("#select-collection",e).on("change",function(){var e=$(this).val();""!=e&&ham.helper.ajax("/mycollection/"+e+"/list",null,"GET",function(e,t){if(e){var t=i.setup_data(t),o=i.get_template(t,"selected_artwork");i.render_content(t,o)}})})},search_artwork:function(){$("#search-artwork",e).on("click",function(t){var o=$.trim($("#select-object",e).val());""!=o&&i.get_artwork(o),t.preventDefault()})},get_artwork:function(r){ham.helper.ajax("/artwork/getInfo/"+r,null,"GET",function(r,n){if(r&&n&&(n.imagecount>0||a)){var s=i.setup_data([n]),l=$.grep(i.artworks,function(e){return e.objectnumber==n.objectnumber});if(s[0].imagecount>1&&o){var s=i.setup_child_data(s[0]),c=i.get_template(s,"select_image_thumbs");i.render_child(s,c)}else if(l.length<=0){var c=i.get_template(s,"selected_artwork");i.render_content(s,c),$("#select-object",e).val(""),t.removeClass("control--error").find(".msg-error").remove()}else i.error(2)}else n.imagecount<=0?i.error(3):i.error(1);t.focus()})},error:function(e){switch(e){case 1:var o="No artwork found";break;case 2:var o="Artwork already selected";break;case 3:var o="Sorry, this object does not have an associated image."}$(".msg-error",t).remove(),t.addClass("control--error").find('input[type="text"]').before('<span class="msg-error">'+o+"</span>")},setup_data:function(e){return $.each(e,function(e,t){if(t.people){var o=t.people.length-1;$.each(t.people,function(e,t){o==e&&(t.last=!0)})}else t.people={},t.people.displayname="Unidentified Artist",t.people.last=!0;t.primaryimageurl||(t.primaryimageurl="/assets/images/no_image_thumb.png"),!t.copyright&&t.imagecount>0&&(t.copyright=t.images[0].copyright),t.renditionnumber=t.imagecount>0?t.images[0].renditionnumber:0}),e},get_template:function(e,t){var t=ham.templates[t];return $.parseHTML(Mustache.render(t,{array:e}))},render_content:function(t,o){$("#selected-artwork",e).prepend(o),$.each(t,function(t,o){$("#selected-artwork",e).trigger({type:"artwork_added",item:o}),i.artworks.push({objectnumber:o.objectnumber,renditionnumber:o.renditionnumber})})},remove_artwork:function(){var o=$("#selected-artwork",e);o.on("click","[data-remove]",function(a){var r=$(this),n={objectnumber:r.data("artwork"),renditionnumber:r.data("renditionnumber")};$("#selected-artwork",e).trigger({type:"artwork_removed",artwork:n}),i.artworks=$.grep(i.artworks,function(e){return e.objectnumber!=n.objectnumber||e.renditionnumber!=n.renditionnumber}),r.closest(".artwork-preview").remove(),$(".artwork-preview",o).length<=0&&($("#select-by-collection, #select-by-id",e).removeClass("disabled").find("select, input").prop("disabled",!1).val(""),t.removeClass("control--error").find(".msg-error").remove()),a.preventDefault()})},setup_child_data:function(e,t){var o=[];return $.each(e.images,function(t,a){var i={objectid:e.objectid,objectnumber:e.objectnumber,title:e.title,title_trimmed:e.title.substring(0,30)+"...",creditline:e.creditline,primaryimageurl:a.baseimageurl.split("?")[0],renditionnumber:a.renditionnumber};o.push(i)}),e.object_title=e.title,e.count=o.length,e.item_text=1==o.length?"image":"images",e.has_items=o.length>0,e.items=o,e},render_child:function(o,a){var r=$("#img-search-thumbs");r.html(a).removeClass("hidden"),$(".popup-img-search__close",r).on("click",function(e){r.addClass("fade-out"),setTimeout(function(){r.addClass("hidden").removeClass("fade-out").empty()},201),e.preventDefault()}),$(".my-collections__item a",r).on("click",function(a){var n=$(this);if(o.primaryimageurl=n.data("img"),o.renditionnumber=n.data("renditionnumber"),o.copyright=n.data("copyright"),$.grep(i.artworks,function(e){return e.objectnumber==o.objectnumber&&e.renditionnumber==o.renditionnumber}).length<=0){var s=i.get_template(o,"selected_artwork");i.render_content([o],s),$("#select-object",e).val(""),t.removeClass("control--error").find(".msg-error").remove()}else i.error(2);$(".popup-img-search__close",r).click(),a.preventDefault()}),$("#img-search-thumbs .popup").show()}};i.init()},ham.behavior.slideshow_grid_index=function(e){"use strict";var t={slideshow:{index:0,images:[]},init:function(){t.get_data(),$('a[href="#"]',e).on("click",function(e){e.preventDefault(),t.slideshow.index=$(this).closest("li").index(),t.open_lightbox()})},get_data:function(){$("li",e).each(function(e,o){var a=$(this),i={title:a.data("title"),caption:a.data("caption"),credit:a.data("credit"),image:a.data("image")};t.slideshow.images.push(i)})},get_template:function(){return $.parseHTML(Mustache.render(ham.templates.slideshow_popup,t.slideshow))},open_lightbox:function(){$.magnificPopup.open({type:"inline",preloader:!1,items:{src:t.get_template()},alignTop:!0,mainClass:"mfp-viewer-slideshow index-popup-slideshow",closeOnBgClick:!1,closeBtnInside:!0,midClick:!0,overflowY:"scroll",removalDelay:200,callbacks:{open:function(){ham.LoadBehavior(this.content),ham.behavior.tour_slideshow()},change:function(){},close:function(){}}})}};t.init()},ham.behavior.slideshow_thumbs=function(e){"use strict";function t(e,t){s=ham.helper.is_mobile()?85:190;var o=n.innerWidth(),a=Math.floor(o/s),i=t.count;e.width(s*Math.min(a,i)),$(".slideshow__direction-nav",n).toggleClass("hidden",a>=i),n.toggleClass("no-transform",a>=i),t.vars.itemWidth=s,t.itemW=s,$(t.slides).width(s),t.update()}function o(t){if(ham.helper.is_mobile()){var o=$("li:eq("+t+") figcaption",r).html();i||(e.append('<div class="slideshow-thumbs__mobile-caption" />'),i=$(".slideshow-thumbs__mobile-caption",e)),i.html(o)}}function a(e){var t=e.next().find("figure"),o=t.find("img"),a=e.prev().find("figure"),i=a.find("img"),r=e.find("figure"),n=r.find("img");n.prop("src")!=n.data("src")&&(n.prop("src",n.data("src")),r.imagesLoaded(function(){r.removeClass("loading"),$(window).resize()})),i.prop("src")!=i.data("src")&&(i.prop("src",i.data("src")),a.imagesLoaded(function(){a.removeClass("loading"),$(window).resize()})),o.prop("src")!=o.data("src")&&(o.prop("src",o.data("src")),t.imagesLoaded(function(){t.removeClass("loading"),$(window).resize()}))}var i,r=$("[data-slideshow-main]",e),n=$("[data-slideshow-thumbs]",e),s=ham.helper.is_mobile()?85:165,l=e.data("start-slide");!function(){n.flexslider({namespace:"slideshow__",animation:"slide",controlNav:!1,animationLoop:!1,slideshow:!1,itemWidth:s,itemMargin:0,asNavFor:r,startAt:l||0,start:function(e){var o=$(".slideshow__viewport",n);t(o,e),$(window).on("resize",$.debounce(200,function(){t(o,e)}))}}),r.flexslider({namespace:"slideshow__",animation:"fade",controlNav:!1,directionNav:!1,animationLoop:!1,slideshow:!1,sync:n,smoothHeight:!1,startAt:l||0,start:function(e){o(e.currentSlide),a($(".slides > li:eq("+e.currentSlide+")",r))},before:function(e){ham.helper.is_mobile()&&(i.clone().addClass("slideshow-thumbs__mobile-caption-clone").insertAfter(i),e.animatingTo>e.currentSlide?(i.addClass("slide-in-right"),$(".slideshow-thumbs__mobile-caption-clone").addClass("slide-out-left")):(i.addClass("slide-in-left"),$(".slideshow-thumbs__mobile-caption-clone").addClass("slide-out-right")),i.on(animEndEventName,function(){i.removeClass("slide-in-left slide-in-right"),i.off(animEndEventName),$(".slideshow-thumbs__mobile-caption-clone").remove()})),o(e.animatingTo)},after:function(e){a($(".slides > li:eq("+e.currentSlide+")",r))}})}()},ham.behavior.social_carousel=function(){"use strict";function e(){i&&!ham.helper.is_tablet_hor()?i=!1:!i&&ham.helper.is_tablet_hor()&&(t(),i=!0)}function t(){a.imagesLoaded(function(){a.flexslider({namespace:"slideshow__",selector:".slides > .slide",animation:"slide",slideshow:!1,controlNav:!1,animationLoop:!1,itemMargin:0,start:function(){$(".slideshow").addClass("slideshow-ready")}})})}var o,a=$(this),i=!1;e(),$(window).on("resize",function(){clearTimeout(o),o=setTimeout(e,250)})},ham.behavior.sticky_cat_scroll=function(e){"use strict";$("body").imagesLoaded(function(){function t(){var t=$(window).scrollTop()-i+n;t>0&&t<f?(e.removeClass("abs").addClass("sticky"),e.before(h)):t<=0?(e.removeClass("sticky abs"),h.remove()):(e.removeClass("sticky").addClass("abs"),e.before(h))}function o(){i=a(e),s=e.height(),c=parseInt(l.css("padding-left"))+parseInt(l.css("padding-right")),d=l.innerWidth()-c,u=i-p.offset().top,m=p.height()-u,f=m-s}function a(t){var o;return e.removeClass("sticky abs"),o=t.offset().top,$(window).scroll(),o}var i=a(e),r=e.data("sticky-parent"),n=e.data("sticky-buffer")?e.data("sticky-buffer"):0,s=e.height(),l=e.parent(),c=parseInt(l.css("padding-left"))+parseInt(l.css("padding-right")),d=l.innerWidth()-c,p=e.parents(r),u=i-p.offset().top,m=p.height()-u,f=m-s,h=$("<div />");e.width(d),h.height(s),$(window).on("scroll.sticky",$.throttle(50,function(e){t()})),$(window).on("resize",$.debounce(100,function(){o(),e.width(d),h.height(s),$(window).on("scroll.sticky",$.throttle(50,function(e){t()}))}))})},ham.behavior.sticky_detail_scroll=function(e){"use strict";$("body").imagesLoaded(function(){function t(){var t=$(window).scrollTop()-i+n;t>0&&t<f?(e.removeClass("abs").addClass("sticky"),e.before(h)):t<=0?(e.removeClass("sticky abs"),h.remove()):(e.removeClass("sticky").addClass("abs"),e.before(h))}function o(){i=a(e),s=e.height(),c=parseInt(l.css("padding-left"))+parseInt(l.css("padding-right")),d=l.innerWidth()-c,u=i-p.offset().top,m=p.height()-u,f=m-s}function a(t){var o;return e.removeClass("sticky abs"),o=t.offset().top,$(document).scroll(),o}var i=a(e),r=e.data("sticky-parent"),n=e.data("sticky-buffer")?e.data("sticky-buffer"):0,s=e.height(),l=e.parent(),c=parseInt(l.css("padding-left"))+parseInt(l.css("padding-right")),d=l.innerWidth()-c,p=e.parents(r),u=i-p.offset().top,m=p.height()-u,f=m-s,h=$("<div />");e.width(d),h.height(s),$(document).on("scroll.sticky",$.throttle(50,function(e){t()})),$(window).on("resize",$.debounce(100,function(){o(),e.width(d),h.height(s),$(document).on("scroll.sticky",$.throttle(50,function(e){t()}))}))})},ham.behavior.sticky_header=function(){"use strict";function e(e){e>170&&!r?(r=!0,t()):e<=170&&r&&(r=!1,i||o())}function t(){a.addClass("page-header--fixed")}function o(){a.removeClass("page-header--fixed"),$.event.trigger({type:"hide_nav_site_search"})}var a=$(this),i=!1,r=!1;ham.helper.is_touch||($(window).on("scroll",$.throttle(100,function(){e($(window).scrollTop())})),a.on({mousemove:function(e){t()},mouseleave:function(){!1===r&&o()}}),$(".logo--large").on({mousemove:function(){t()},mouseleave:function(e){0==r&&e.pageY>139&&o()}}))},ham.behavior.sticky_scroll=function(e){"use strict";ham.helper.is_touch||$("body").imagesLoaded(function(){function t(){var t=$(window).scrollTop()-i+n;t>0&&t<f?(e.removeClass("abs").addClass("sticky"),e.before(h)):t<=0?(e.removeClass("sticky abs"),h.remove()):(e.removeClass("sticky").addClass("abs"),e.before(h))}function o(){i=a(e),s=e.height(),c=parseInt(l.css("padding-left"))+parseInt(l.css("padding-right")),d=l.innerWidth()-c,u=i-p.offset().top,m=p.height()-u,f=m-s}function a(t){var o;return e.removeClass("sticky abs"),o=t.offset().top,$(window).scroll(),o}var i=a(e),r=e.data("sticky-parent"),n=e.data("sticky-buffer")?e.data("sticky-buffer"):0,s=e.height(),l=e.parent(),c=parseInt(l.css("padding-left"))+parseInt(l.css("padding-right")),d=l.innerWidth()-c,p=e.parents(r),u=i-p.offset().top,m=p.height()-u,f=m-s,h=$("<div />");e.width(d),h.height(s),$(window).on("scroll.sticky",$.throttle(50,function(e){t()})),$(window).on("resize",$.debounce(100,function(){o(),e.width(d),h.height(s),ham.helper.is_mobile()?$(window).off("scroll.sticky"):$(window).on("scroll.sticky",$.throttle(50,function(e){t()}))}))})},ham.behavior.tabs=function(e){"use strict";var t=$("[data-tab-triggers] a",e),o=$(".tabs__tab",e);t.on("click",function(e){var a=$(this),i=a.prop("hash"),r=$(i);a.hasClass("tabs__trigger--active")||(o.removeClass("tabs__tab--active"),r.addClass("tabs__tab--active"),t.removeClass("tabs__trigger--active"),a.addClass("tabs__trigger--active")),e.preventDefault()}),t.first().click()},ham.behavior.toc=function(e){"use strict";$("a[data-type]",e).on("click",function(e){var t=$(this);if("toc"==t.data("type")){var o={toc_main_children:ham.viewer.templates.toc_main_children};ham.viewer.current.view="toc",$.event.trigger("view_change"),ham.viewer.helper.close_menu(),ham.viewer.helper.set_template(ham.viewer.current.nav,ham.viewer.templates.toc_main,!1,null,o),ham.LoadBehavior("#viewer-main")}else{var a=t.data("type"),i=t.data("view-id"),r=t.data("view-index");ham.viewer.helper.load_view(i,a,null,r)}e.preventDefault()})},ham.behavior.toggle_input=function(e){"use strict";var t=e.prop("name");$('[name="'+t+'"]').on("change",function(){var t=$(e.data("toggle"));e.is(":checked")?t.removeClass("hidden"):t.addClass("hidden")})},ham.behavior.toggle=function(e){"use strict";e.on("click",function(t){var o=$(e.prop("hash"));e.hasClass("btn--disabled")||(e.toggleClass("toggle--active"),o.toggleClass("toggle-target--active")),$("[data-toggle-close]",o).on("click",function(t){e.removeClass("toggle--active"),o.removeClass("toggle-target--active"),t.preventDefault()}),t.preventDefault()})},ham.behavior.toolbox=function(e){"use strict";function t(e){e.removeClass("toolbox--fixed");var t=e.position().top+parseInt(e.css("margin-top"));return i.scroll(),t}var o=e.siblings("figure").find("img"),a=$('<div class="toolbox__spacer" />'),i=e.closest(".artwork__wrapper").length>0?e.closest(".artwork__wrapper"):$(window),r=t(e),n=i.scrollTop();o.imagesLoaded(function(){setTimeout(function(){r=t(e)},1)}),e.after(a),$(window).resize(function(){r=t(e)}),i.scroll(function(){n=i.scrollTop(),e.toggleClass("toolbox--fixed",n>r-20),a.toggleClass("toolbox__spacer--active",n>r-20)})},ham.behavior.tooltip=function(e){"use strict";var t=e.parent();"static"==t.css("position")&&t.css("position","relative"),e.on({mouseenter:function(){var e=$(this),t=e.data("tooltip")||e.text(),o=$('<div class="tooltip">'+t+"</div>");e.after(o),o.outerWidth()>240&&o.addClass("tooltip--wide")},mouseleave:function(){var e=$(this),t=e.next(".tooltip");t.addClass("tooltip--anim-out"),t.remove()}})},ham.behavior.top_link=function(){"use strict";$(this).on("click",function(e){$("html, body").animate({scrollTop:0},500),e.preventDefault()})},ham.behavior.tour_overlay=function(e){"use strict";function t(){var t=e.innerWidth();i.width(t),a.position().left>=t&&(a.css({left:t-1}),r.width(t-1)),o()}function o(){i.each(function(){var e=$(this);e.height()>n&&(n=e.height())}),e.height(n)}var a=$('<div class="tour-overlay__handle"><span /></div>'),i=$(".tour-overlay__image-wrapper img",e),r=$(".tour-overlay__image-wrapper",e).first(),n=($('<div class="tour-overlay__image-data">'),0);t(),e.append(a),a.draggable({axis:"x",containment:e,drag:function(e,t){r.width(t.position.left)}}),$(window).resize($.debounce(200,function(){n=0,t()}))},ham.behavior.usg_request=function(e){"use strict";var t={artworks:JSON.parse($("[data-artwork-ids]").val())||[],init:function(){t.handle_events(),e.on("submit","form",function(e){if($("#select-object").is(":focus"))$("#search-artwork").click();else{var o=new FormData(this);t.send_data(o)}e.preventDefault()})},handle_events:function(){$("#selected-artwork",e).on("artwork_added",function(o){var a={objectnumber:o.item.objectnumber};t.artworks.push(a),$("[data-artwork-ids]",e).val(JSON.stringify(t.artworks))}),$("#selected-artwork",e).on("artwork_removed",function(o){t.artworks=$.grep(t.artworks,function(e){return e.objectnumber!=o.artwork.objectnumber}),$("[data-artwork-ids]",e).val(JSON.stringify(t.artworks))})},send_data:function(o){e.find(".control__button").addClass("btn--loading"),ham.helper.file_ajax("/usgrequest",o,"POST",function(o,a){e.find(".control__button").removeClass("btn--loading"),o?t.handle_success():t.handle_error(a)})},handle_success:function(t){var o=e.find(".control__button").width();e.find(".control--error").removeClass("control--error"),e.find(".control__button").width(o).addClass("btn-success").val("Sent!").prop("disabled",!0)},handle_error:function(o){var a=$(".usg-request-form",e),i=$(o.responseText).find(".usg-request-form");a.html(i.html()),ham.LoadBehavior(a),t.handle_events(),e.closest(".mfp-wrap").length>0?e.closest(".mfp-wrap").animate({scrollTop:$(".control--error").eq(0).position().top-120},300):$("html, body").animate({scrollTop:$(".control--error").eq(0).offset().top-120},300)}};t.init()},ham.behavior.video_thumb_play=function(e){"use strict";$(this).find($(".video-thumb-play__thumb")).click(function(e){e.preventDefault();var t=$(this).parent().find($("iframe")),o=t.prop("src");~o.toLowerCase().indexOf("autoplay=1")||(o+="&autoplay=1",t.prop("src",o)),$(this).parent().addClass("hide-thumb")})},ham.behavior.viewer_setup=function(e){"use strict";var t={init:function(o){t.view_mode="preview"==o&&"tour"==e.data("type")?"view":o,t.tour_id=e.data("tour-id"),t.object_type=e.data("type"),t.object_id=e.data("id"),t.get_tour_data(t.tour_id),$.ajax({url:"/user/getcurrent",async:!1}).done(function(e){ham.viewer.current.user=e})},get_tour_data:function(e){ham.helper.ajax("/tour/"+e+"/getInfo",null,"GET",function(e,o){ham.viewer.current.tour=o,t.get_navigation()})},set_main:function(o){var a={toc:ham.viewer.templates.toc};window!=window.top?o.show_close=!1:o.show_close=!0,o.close_link=e.data("referrer")||"http://"+window.location.hostname+"/tours",o.pdf_link="http://"+window.location.hostname+"/tour/"+ham.viewer.current.tour.slug+"/pdf/",ham.viewer.current.user&&(o.user=!0),o.show_counter=ham.viewer.current.tour.show_counter,o.printing_allowed=ham.viewer.current.tour.printing_allowed,ham.viewer.helper.set_template(o,ham.viewer.templates.main,!1,e,a,function(e){t.start_tour(e)})},get_navigation:function(){ham.helper.ajax("/tours/nav/"+t.tour_id,null,"GET",function(e,o){if(e){var a={id:o.id,title:o.title,description:o.description.replace(/\r?\n/g,"<br />"),stops:[]},i=0;$.each(o.stops,function(e,t){var o=0;if(t.first_slide_title&&t.slides.length)var r=t.slides[0],n={id:r.id,title:r.title,type:"title_slide",image_file:t.image_file,slides:[],is_title_slide:!0,index:i};else var n={id:t.id,title:t.title,type:"stop",image_file:t.image_file,slides:[],index:i,has_slides:!!t.slides};$.each(t.slides,function(e,a){var i={id:a.id,title:a.title,stop_id:t.id,trimmed_title:a.title.substring(0,25),type:"slide",index:o,count:o+1};parseInt(t.first_slide_title)?0!=o&&n.slides.push(i):n.slides.push(i),o++}),n.num_slides=1==n.slides.length?"1 slide":n.slides.length+" slides",a.stops.push(n),i++}),ham.viewer.current.nav=a,a.total=ham.viewer.helper.counter(),t.set_main(a)}})},get_index:function(e,t){var o=ham.viewer.current.nav.stops,a={stop:0,slide:0};switch(e){case"stop":$.each(o,function(e,o){if(o.id===t)return void(a.stop=o.index)});break;case"slide":$.each(o,function(e,o){o.slides&&$.each(o.slides,function(e,i){if(i.id===t)return a.stop=o.index,void(a.slide=i.index)})})}return a},start_tour:function(o){switch(ham.LoadBehavior(o),t.object_type){case"stop":var a=t.get_index("stop",t.object_id),i=a.stop;ham.viewer.helper.load_view(t.object_id,t.object_type,null,i);break;case"slide":var a=t.get_index("slide",t.object_id),i=a.slide;ham.viewer.current.stop_index=a.stop,ham.viewer.helper.load_view(t.object_id,t.object_type,{hash:window.location.hash},i);break;default:ham.viewer.helper.load_toc()}$(".tours-footer__notes",e).on("click",function(t){if(ham.helper.is_mobile()){var o=$(".tours-footer__notes",e);setTimeout(function(){$("html, body").animate({scrollTop:o.offset().top})},200)}}),e.on("click",".tour-text a",function(e){var t=$(this).prop("href"),o=t.split("/"),a=o[3];if(o.length>4)for(var i=4;i<o.length-1;i++)a+=o[i];if("collectionsobject"!=a){var r=$(this).prop("href").split("#"),n=r[0],s=r[1];n.match(window.location.pathname)?s&&history.pushState({type:"anchor"},"Anchor",n+"#"+s):(e.preventDefault(),n+=s?"#"+s:"",window.open(n))}}),$(window).on("resize",$.debounce(100,function(){$("#tour-viewer").outerHeight()<win_h?$(".tours-footer").addClass("tours-footer--fix"):$(".tours-footer").removeClass("tours-footer--fix")})),$(window).on("popstate",function(e){var o=history.state;if(!o||"stop"!=o.type&&"slide"!=o.type)o&&"anchor"!=o.type&&ham.viewer.helper.load_toc();else{var a=t.get_index(o.type,t.object_id),i=a[o.type];ham.viewer.current[o.type+"_index"]=a[o.type],ham.viewer.helper.load_view(o.id,o.type,null,i,!0)}})}};t.init(e.data("mode"))},ham.helper.ajax=function(e,t,o,a){"use strict";$.ajax({type:o||"POST",url:e,data:t,cache:!1,headers:{"X-CSRF-Token":$('meta[name="csrf-token"]').attr("content")}}).done(function(e,t,o){a&&a(!0,e)}).fail(function(e,t,o){a&&a(!1,e,t,o)})},ham.helper.custom_select=function(e){"use strict";$("select",e).each(function(){var e=$(this),t=$('<span class="select__text" />'),o=e.prop("class"),a=e.children(":selected").text();t.text(a),e.wrap('<div class="select '+o+'" />').after(t),e.change(function(o){t.html(e.children("option:selected").text()),e.val()!==a?t.addClass("active"):t.removeClass("active")})})},ham.helper.file_ajax=function(e,t,o,a){"use strict";$.ajax({type:o||"POST",url:e,data:t,processData:!1,contentType:!1,cache:!1,headers:{"X-CSRF-Token":$('meta[name="csrf-token"]').attr("content")}}).done(function(e,t,o){a&&a(!0,e)}).fail(function(e,t,o){a&&a(!1,e,t,o)})},ham.viewer.helper.get_template=function(e,t,o){"use strict";switch(e){case"tour":e=ham.viewer.templates.tour;break;case"stop":e=ham.viewer.templates.stop;break;case"slide":e=ham.viewer.templates.slide}return $.parseHTML(Mustache.render(e,t,o))},ham.helper.inline_popup=function(e,t,o,a,i){"use strict";(e instanceof window.jQuery?e:$(e)).magnificPopup({type:"inline",alignTop:!!ham.helper.is_mobile(),fixedContentPos:!0,preloader:!1,focus:o||null,items:{src:t},mainClass:"mfp-trans-bg "+i,closeMarkup:'<button title="%title%" class="mfp-close">Back <i class="mfp-close-icn"></i></button>',closeOnBgClick:!1,midClick:!0,overflowY:"scroll",removalDelay:200,callbacks:a})},ham.helper.open_artwork=function(){"use strict";var e,t=$('<div class="artwork__wrapper artwork__wrapper--out"></div>'),o=!1,a=document.title,i={title:$('meta[property="og:title"]').prop("content"),url:$('meta[property="og:url"]').prop("content"),description:$('meta[property="og:description"]').prop("content"),image:$('meta[property="og:image"]').prop("content")},r=window.parent.document,n=!1,s={init:function(){s.add_handler()},add_handler:function(){$("body").on("click",'[href*="/collections/object/"]:not(.popup__share a)',function(o){e=e||window.location.href,$("#popup-share").remove(),s.load_artwork($(this).prop("href")),$("#artwork",t).addClass("artwork--out"),$(".mfp-close",r).hide(),o.stopImmediatePropagation(),o.preventDefault()}),$("body").on("click",".artwork__close",function(t){e.indexOf("/collections/object/")<0&&e.indexOf("/art/")<0&&(s.close_artwork(),e=void 0,t.preventDefault())}),$(window).on("popstate",function(e){var t=history.state;t&&"artwork"==t.type?s.load_artwork(t.url,!0):s.close_artwork(!0)}),$(document).on("keyup",function(e){if(37!=e.keyCode&&39!=e.keyCode||n)27==e.keyCode&&t.find(".artwork__close").click();else{n=!0;var o=$("body").find(".artwork__wrapper").length>0?t:$("body");37==e.keyCode?($(".artwork-nav__prev a",o).click(),e.preventDefault()):39==e.keyCode&&($(".artwork-nav__next a",o).click(),
e.preventDefault())}})},load_artwork:function(e,a){o||($("body").append(t),setTimeout(function(){t.removeClass("artwork__wrapper--out")},1),o=!0),$("html").addClass("mfp-ajax--open"),t.load(e+" #artwork",function(o,i,r){var s=$("#artwork",t),l=$(o).filter("title").text(),c={title:$(o).filter('meta[property="og:title"]').prop("content"),url:$(o).filter('meta[property="og:url"]').prop("content"),description:$(o).filter('meta[property="og:description"]').prop("content"),image:$(o).filter('meta[property="og:image"]').prop("content").split("?")[0]};t.scrollTop(0),osd_viewer&&(osd_viewer.destroy(),osd_viewer=null),ham.LoadBehavior(s),ga("send","pageview",{page:e,title:l}),s.removeClass("artwork--out"),n=!1,a||history.pushState({type:"artwork",url:e},l,e),document.title=l,$('meta[property="og:title"]').prop("content",c.title),$('meta[property="og:url"]').prop("content",c.url),$('meta[property="og:description"]').prop("content",c.description),$('meta[property="og:image"]').prop("content",c.image+"?width=400&height=400")})},close_artwork:function(n){$("html").removeClass("mfp-ajax--open"),document.title=a,$('meta[property="og:title"]').prop("content",i.title),$('meta[property="og:url"]').prop("content",i.url),$('meta[property="og:description"]').prop("content",i.description),t.addClass("artwork__wrapper--out"),$(".hero-artwork__cursor").remove(),$(".mfp-close",r).show(),osd_viewer&&(osd_viewer.destroy(),osd_viewer=null),o=!1,n||history.pushState(null,null,e),setTimeout(function(){t.empty().remove()},300)}};s.init()},ham.viewer.helper.set_template=function(e,t,o,a,i,r){"use strict";e&&(e.namespace=Date.now());var o=o||!1,a=a||"#viewer-main",n=a instanceof window.jQuery?a:$(a),t=ham.viewer.helper.get_template(t,e,i);1==o?n.append(t):n.html(t),r&&r(t)};